"use strict";(self.webpackChunkmy_vuepress_site=self.webpackChunkmy_vuepress_site||[]).push([[633],{8336:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>u,data:()=>r});var e=a(641);const l=a.p+"assets/img/langchain.7b85548f.png",p=a.p+"assets/img/model_io.1f23a362.jpg",i=a.p+"assets/img/data_connection.6486e194.jpg",t=a.p+"assets/img/agent-overview.afaf1154.png",o=a.p+"assets/img/ReAct.cc7d9130.png",c={},u=(0,a(6262).A)(c,[["render",function(n,s){return(0,e.uX)(),(0,e.CE)("div",null,[...s[0]||(s[0]=[(0,e.Fv)('<h1 id="_08-langchain-index" tabindex="-1"><a class="header-anchor" href="#_08-langchain-index"><span>08 Langchain Index</span></a></h1><h2 id="ğŸ’¡-è¿™èŠ‚è¯¾ä¼šå¸¦ç»™ä½ " tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-è¿™èŠ‚è¯¾ä¼šå¸¦ç»™ä½ "><span>ğŸ’¡ è¿™èŠ‚è¯¾ä¼šå¸¦ç»™ä½ </span></a></h2><ol><li>å¦‚ä½•ä½¿ç”¨ LangChainï¼šä¸€å¥—åœ¨å¤§æ¨¡å‹èƒ½åŠ›ä¸Šå°è£…çš„å·¥å…·æ¡†æ¶</li><li>å¦‚ä½•ç”¨å‡ è¡Œä»£ç å®ç°ä¸€ä¸ªå¤æ‚çš„ AI åº”ç”¨</li><li>é¢å‘å¤§æ¨¡å‹çš„æµç¨‹å¼€å‘çš„è¿‡ç¨‹æŠ½è±¡</li></ol><p>å¼€å§‹ä¸Šè¯¾ï¼</p><h2 id="ğŸ“-è¿™èŠ‚è¯¾æ€ä¹ˆå­¦" tabindex="-1"><a class="header-anchor" href="#ğŸ“-è¿™èŠ‚è¯¾æ€ä¹ˆå­¦"><span>ğŸ“ è¿™èŠ‚è¯¾æ€ä¹ˆå­¦</span></a></h2><p>ä»£ç èƒ½åŠ›è¦æ±‚ï¼š<strong>ä¸­é«˜</strong>ï¼ŒAI/æ•°å­¦åŸºç¡€è¦æ±‚ï¼š<strong>æ— </strong></p><ol><li>æœ‰ç¼–ç¨‹åŸºç¡€çš„åŒå­¦ <ul><li>å…³æ³¨è®¾è®¡æ€è·¯ï¼Œå®ç°ç»†èŠ‚</li></ul></li><li>æ²¡æœ‰ç¼–ç¨‹åŸºç¡€çš„åŒå­¦ <ul><li>å°½é‡ç†è§£ SDK çš„æ¦‚å¿µå’Œä»·å€¼ï¼Œå°è¯•ä½“ä¼šä½¿ç”¨ SDK å‰åçš„å·®åˆ«ä¸æ„ä¹‰</li></ul></li></ol><h2 id="å†™åœ¨å‰é¢" tabindex="-1"><a class="header-anchor" href="#å†™åœ¨å‰é¢"><span>å†™åœ¨å‰é¢</span></a></h2><ul><li>LangChain ä¹Ÿæ˜¯ä¸€å¥—é¢å‘å¤§æ¨¡å‹çš„å¼€å‘æ¡†æ¶ï¼ˆSDKï¼‰</li><li>LangChain æ˜¯ AGI æ—¶ä»£è½¯ä»¶å·¥ç¨‹çš„ä¸€ä¸ªæ¢ç´¢å’ŒåŸå‹</li><li>å­¦ä¹  LangChain è¦å…³æ³¨æ¥å£å˜æ›´</li></ul><h2 id="langchain-çš„æ ¸å¿ƒç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#langchain-çš„æ ¸å¿ƒç»„ä»¶"><span>LangChain çš„æ ¸å¿ƒç»„ä»¶</span></a></h2><ol><li>æ¨¡å‹ I/O å°è£… <ul><li>LLMsï¼šå¤§è¯­è¨€æ¨¡å‹</li><li>Chat Modelsï¼šä¸€èˆ¬åŸºäº LLMsï¼Œä½†æŒ‰å¯¹è¯ç»“æ„é‡æ–°å°è£…</li><li>PromptTempleï¼šæç¤ºè¯æ¨¡æ¿</li><li>OutputParserï¼šè§£æè¾“å‡º</li></ul></li><li>æ•°æ®è¿æ¥å°è£… <ul><li>Document Loadersï¼šå„ç§æ ¼å¼æ–‡ä»¶çš„åŠ è½½å™¨</li><li>Document Transformersï¼šå¯¹æ–‡æ¡£çš„å¸¸ç”¨æ“ä½œï¼Œå¦‚ï¼šsplit, filter, translate, extract metadata, etc</li><li>Text Embedding Modelsï¼šæ–‡æœ¬å‘é‡åŒ–è¡¨ç¤ºï¼Œç”¨äºæ£€ç´¢ç­‰æ“ä½œï¼ˆå•¥æ„æ€ï¼Ÿåˆ«æ€¥ï¼Œåé¢è¯¦ç»†è®²ï¼‰</li><li>Verctorstores: ï¼ˆé¢å‘æ£€ç´¢çš„ï¼‰å‘é‡çš„å­˜å‚¨</li><li>Retrievers: å‘é‡çš„æ£€ç´¢</li></ul></li><li>å¯¹è¯å†å²ç®¡ç† <ul><li>å¯¹è¯å†å²çš„å­˜å‚¨ã€åŠ è½½ä¸å‰ªè£</li></ul></li><li>æ¶æ„å°è£… <ul><li>Chainï¼šå®ç°ä¸€ä¸ªåŠŸèƒ½æˆ–è€…ä¸€ç³»åˆ—é¡ºåºåŠŸèƒ½ç»„åˆ</li><li>Agentï¼šæ ¹æ®ç”¨æˆ·è¾“å…¥ï¼Œè‡ªåŠ¨è§„åˆ’æ‰§è¡Œæ­¥éª¤ï¼Œè‡ªåŠ¨é€‰æ‹©æ¯æ­¥éœ€è¦çš„å·¥å…·ï¼Œæœ€ç»ˆå®Œæˆç”¨æˆ·æŒ‡å®šçš„åŠŸèƒ½ <ul><li>Toolsï¼šè°ƒç”¨å¤–éƒ¨åŠŸèƒ½çš„å‡½æ•°ï¼Œä¾‹å¦‚ï¼šè°ƒ google æœç´¢ã€æ–‡ä»¶ I/Oã€Linux Shell ç­‰ç­‰</li><li>Toolkitsï¼šæ“ä½œæŸè½¯ä»¶çš„ä¸€ç»„å·¥å…·é›†ï¼Œä¾‹å¦‚ï¼šæ“ä½œ DBã€æ“ä½œ Gmail ç­‰ç­‰</li></ul></li></ul></li><li>Callbacks</li></ol><p><img src="'+l+'" alt="image"></p><h3 id="æ–‡æ¡£-ä»¥-python-ç‰ˆä¸ºä¾‹" tabindex="-1"><a class="header-anchor" href="#æ–‡æ¡£-ä»¥-python-ç‰ˆä¸ºä¾‹"><span>æ–‡æ¡£ï¼ˆä»¥ Python ç‰ˆä¸ºä¾‹ï¼‰</span></a></h3><ul><li>åŠŸèƒ½æ¨¡å—ï¼šhttps://python.langchain.com/docs/get_started/introduction</li><li>API æ–‡æ¡£ï¼šhttps://api.python.langchain.com/en/latest/langchain_api_reference.html</li><li>ä¸‰æ–¹ç»„ä»¶é›†æˆï¼šhttps://python.langchain.com/docs/integrations/platforms/</li><li>å®˜æ–¹åº”ç”¨æ¡ˆä¾‹ï¼šhttps://python.langchain.com/docs/use_cases</li><li>è°ƒè¯•éƒ¨ç½²ç­‰æŒ‡å¯¼ï¼šhttps://python.langchain.com/docs/guides/debugging</li></ul><h2 id="ä¸€ã€æ¨¡å‹-i-o-å°è£…" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ¨¡å‹-i-o-å°è£…"><span>ä¸€ã€æ¨¡å‹ I/O å°è£…</span></a></h2><p>æŠŠä¸åŒçš„æ¨¡å‹ï¼Œç»Ÿä¸€å°è£…æˆä¸€ä¸ªæ¥å£ï¼Œæ–¹ä¾¿æ›´æ¢æ¨¡å‹è€Œä¸ç”¨é‡æ„ä»£ç ã€‚</p><h3 id="_1-1-æ¨¡å‹-api-llm-vs-chatmodel" tabindex="-1"><a class="header-anchor" href="#_1-1-æ¨¡å‹-api-llm-vs-chatmodel"><span>1.1 æ¨¡å‹ APIï¼šLLM vs. ChatModel</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># !pip install --upgrade langchain</span></span>\n<span class="line"><span class="token comment"># !pip install --upgrade langchain-openai</span></span>\n<span class="line"><span class="token comment"># !pip install --upgrade langchain-community</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-1-1-openai-æ¨¡å‹å°è£…" tabindex="-1"><a class="header-anchor" href="#_1-1-1-openai-æ¨¡å‹å°è£…"><span>1.1.1 OpenAI æ¨¡å‹å°è£…</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"></span>\n<span class="line">llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;gpt-4o-mini&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># é»˜è®¤æ˜¯gpt-3.5-turbo</span></span>\n<span class="line">response <span class="token operator">=</span> llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token string">&quot;ä½ æ˜¯è°&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">æˆ‘æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œæ—¨åœ¨å›ç­”é—®é¢˜å’Œæä¾›ä¿¡æ¯ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-1-2-å¤šè½®å¯¹è¯-session-å°è£…" tabindex="-1"><a class="header-anchor" href="#_1-1-2-å¤šè½®å¯¹è¯-session-å°è£…"><span>1.1.2 å¤šè½®å¯¹è¯ Session å°è£…</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>schema <span class="token keyword">import</span> <span class="token punctuation">(</span></span>\n<span class="line">    AIMessage<span class="token punctuation">,</span>  <span class="token comment"># ç­‰ä»·äºOpenAIæ¥å£ä¸­çš„assistant role</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">,</span>  <span class="token comment"># ç­‰ä»·äºOpenAIæ¥å£ä¸­çš„user role</span></span>\n<span class="line">    SystemMessage  <span class="token comment"># ç­‰ä»·äºOpenAIæ¥å£ä¸­çš„system role</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">messages <span class="token operator">=</span> <span class="token punctuation">[</span></span>\n<span class="line">    SystemMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;ä½ æ˜¯AGIClassçš„è¯¾ç¨‹åŠ©ç†ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;æˆ‘æ˜¯å­¦å‘˜ï¼Œæˆ‘å«ç‹å“ç„¶ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    AIMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;æ¬¢è¿ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;æˆ‘æ˜¯è°&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">]</span></span>\n<span class="line"></span>\n<span class="line">ret <span class="token operator">=</span> llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>messages<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">ä½ æ˜¯ç‹å“ç„¶ï¼Œä¸€ä½å­¦å‘˜ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©çš„åœ°æ–¹ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>âœ… <strong>Tip:</strong> åˆ’é‡ç‚¹ï¼šé€šè¿‡æ¨¡å‹å°è£…ï¼Œå®ç°ä¸åŒæ¨¡å‹çš„ç»Ÿä¸€æ¥å£è°ƒç”¨</p></blockquote><h3 id="_1-1-3-æ¢ä¸ªå›½äº§æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_1-1-3-æ¢ä¸ªå›½äº§æ¨¡å‹"><span>1.1.3 æ¢ä¸ªå›½äº§æ¨¡å‹</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># !pip install qianfan</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># å…¶å®ƒæ¨¡å‹åˆ†è£…åœ¨ langchain_community åº•åŒ…ä¸­</span></span>\n<span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>chat_models <span class="token keyword">import</span> QianfanChatEndpoint</span>\n<span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>messages <span class="token keyword">import</span> HumanMessage</span>\n<span class="line"><span class="token keyword">import</span> os</span>\n<span class="line"></span>\n<span class="line">llm <span class="token operator">=</span> QianfanChatEndpoint<span class="token punctuation">(</span></span>\n<span class="line">    qianfan_ak<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&#39;ERNIE_CLIENT_ID&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    qianfan_sk<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&#39;ERNIE_CLIENT_SECRET&#39;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">messages <span class="token operator">=</span> <span class="token punctuation">[</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">]</span></span>\n<span class="line"></span>\n<span class="line">ret <span class="token operator">=</span> llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>messages<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ–‡å¿ƒä¸€è¨€ï¼Œè‹±æ–‡åæ˜¯ERNIE Botã€‚æˆ‘èƒ½å¤Ÿä¸äººå¯¹è¯äº’åŠ¨ï¼Œå›ç­”é—®é¢˜ï¼ŒååŠ©åˆ›ä½œï¼Œé«˜æ•ˆä¾¿æ·åœ°å¸®åŠ©äººä»¬è·å–ä¿¡æ¯ã€çŸ¥è¯†å’Œçµæ„Ÿã€‚</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-2-æ¨¡å‹çš„è¾“å…¥ä¸è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#_1-2-æ¨¡å‹çš„è¾“å…¥ä¸è¾“å‡º"><span>1.2 æ¨¡å‹çš„è¾“å…¥ä¸è¾“å‡º</span></a></h3><p><img src="'+p+'" alt="image"></p><h3 id="_1-2-1-prompt-æ¨¡æ¿å°è£…" tabindex="-1"><a class="header-anchor" href="#_1-2-1-prompt-æ¨¡æ¿å°è£…"><span>1.2.1 Prompt æ¨¡æ¿å°è£…</span></a></h3><ol><li>PromptTemplate å¯ä»¥åœ¨æ¨¡æ¿ä¸­è‡ªå®šä¹‰å˜é‡</li></ol><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate</span>\n<span class="line"></span>\n<span class="line">template <span class="token operator">=</span> PromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span><span class="token string">&quot;ç»™æˆ‘è®²ä¸ªå…³äº{subject}çš„ç¬‘è¯&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;===Template===&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;===Prompt===&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>subject<span class="token operator">=</span><span class="token string">&#39;å°æ˜&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">===Template===</span>\n<span class="line">input_variables=[&#39;subject&#39;] input_types={} partial_variables={} template=&#39;ç»™æˆ‘è®²ä¸ªå…³äº{subject}çš„ç¬‘è¯&#39;</span>\n<span class="line">===Prompt===</span>\n<span class="line">ç»™æˆ‘è®²ä¸ªå…³äºå°æ˜çš„ç¬‘è¯</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># å®šä¹‰ LLM</span></span>\n<span class="line">llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token comment"># é€šè¿‡ Prompt è°ƒç”¨ LLM</span></span>\n<span class="line">ret <span class="token operator">=</span> llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>subject<span class="token operator">=</span><span class="token string">&#39;å°æ˜&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token comment"># æ‰“å°è¾“å‡º</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³äºå°æ˜çš„ç¬‘è¯ï¼š</span>\n<span class="line"></span>\n<span class="line">å°æ˜åœ¨å­¦æ ¡ä¸Šè¯¾çš„æ—¶å€™ï¼Œè€å¸ˆé—®ä»–ï¼šâ€œå°æ˜ï¼Œå¦‚æœä½ æœ‰10å—é’±ï¼Œä¹°äº†ä¸€æœ¬ä¹¦èŠ±äº†8å—é’±ï¼Œé‚£ä½ è¿˜å‰©ä¸‹å‡ å—é’±ï¼Ÿâ€å°æ˜æƒ³äº†æƒ³è¯´ï¼šâ€œè€å¸ˆï¼Œæˆ‘ä¼šå…ˆå»å›¾ä¹¦é¦†å€Ÿä¹¦ï¼Œç„¶åæˆ‘å°±èƒ½æŠŠé‚£10å—é’±ç•™ç€äº†ï¼â€è€å¸ˆæ— å¥ˆåœ°ç¬‘äº†ç¬‘è¯´ï¼šâ€œå°æ˜ï¼Œä½ çœŸæ˜¯ä¸ªèªæ˜çš„å­©å­ï¼â€</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>ChatPromptTemplate ç”¨æ¨¡æ¿è¡¨ç¤ºçš„å¯¹è¯ä¸Šä¸‹æ–‡</li></ol><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> <span class="token punctuation">(</span></span>\n<span class="line">    ChatPromptTemplate<span class="token punctuation">,</span></span>\n<span class="line">    HumanMessagePromptTemplate<span class="token punctuation">,</span></span>\n<span class="line">    SystemMessagePromptTemplate<span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"></span>\n<span class="line">template <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">[</span></span>\n<span class="line">        SystemMessagePromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span></span>\n<span class="line">            <span class="token string">&quot;ä½ æ˜¯{product}çš„å®¢æœåŠ©æ‰‹ã€‚ä½ çš„åå­—å«{name}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">        HumanMessagePromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span><span class="token string">&quot;{query}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    <span class="token punctuation">]</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line">prompt <span class="token operator">=</span> template<span class="token punctuation">.</span>format_messages<span class="token punctuation">(</span></span>\n<span class="line">    product<span class="token operator">=</span><span class="token string">&quot;AGIè¯¾å ‚&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    name<span class="token operator">=</span><span class="token string">&quot;ç“œç“œ&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    query<span class="token operator">=</span><span class="token string">&quot;ä½ æ˜¯è°&quot;</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">ret <span class="token operator">=</span> llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[SystemMessage(content=&#39;ä½ æ˜¯AGIè¯¾å ‚çš„å®¢æœåŠ©æ‰‹ã€‚ä½ çš„åå­—å«ç“œç“œ&#39;, additional_kwargs={}, response_metadata={}), HumanMessage(content=&#39;ä½ æ˜¯è°&#39;, additional_kwargs={}, response_metadata={})]</span>\n<span class="line">ä½ å¥½ï¼Œæˆ‘æ˜¯AGIè¯¾å ‚çš„å®¢æœåŠ©æ‰‹ï¼Œæˆ‘çš„åå­—å«ç“œç“œã€‚æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>MessagesPlaceholder æŠŠå¤šè½®å¯¹è¯å˜æˆæ¨¡æ¿</li></ol><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> <span class="token punctuation">(</span></span>\n<span class="line">    ChatPromptTemplate<span class="token punctuation">,</span></span>\n<span class="line">    HumanMessagePromptTemplate<span class="token punctuation">,</span></span>\n<span class="line">    MessagesPlaceholder<span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">human_prompt <span class="token operator">=</span> <span class="token string">&quot;Translate your answer to {language}.&quot;</span></span>\n<span class="line">human_message_template <span class="token operator">=</span> HumanMessagePromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span>human_prompt<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">chat_prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token comment"># variable_name æ˜¯ message placeholder åœ¨æ¨¡æ¿ä¸­çš„å˜é‡å</span></span>\n<span class="line">    <span class="token comment"># ç”¨äºåœ¨èµ‹å€¼æ—¶ä½¿ç”¨</span></span>\n<span class="line">    <span class="token punctuation">[</span>MessagesPlaceholder<span class="token punctuation">(</span><span class="token string">&quot;history&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> human_message_template<span class="token punctuation">]</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>messages <span class="token keyword">import</span> AIMessage<span class="token punctuation">,</span> HumanMessage</span>\n<span class="line"></span>\n<span class="line">human_message <span class="token operator">=</span> HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;Who is Elon Musk?&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">ai_message <span class="token operator">=</span> AIMessage<span class="token punctuation">(</span></span>\n<span class="line">    content<span class="token operator">=</span><span class="token string">&quot;Elon Musk is a billionaire entrepreneur, inventor, and industrial designer&quot;</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">messages <span class="token operator">=</span> chat_prompt<span class="token punctuation">.</span>format_prompt<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token comment"># å¯¹ &quot;history&quot; å’Œ &quot;language&quot; èµ‹å€¼</span></span>\n<span class="line">    history<span class="token operator">=</span><span class="token punctuation">[</span>human_message<span class="token punctuation">,</span> ai_message<span class="token punctuation">]</span><span class="token punctuation">,</span> language<span class="token operator">=</span><span class="token string">&quot;ä¸­æ–‡&quot;</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>messages<span class="token punctuation">.</span>to_messages<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[HumanMessage(content=&#39;Who is Elon Musk?&#39;, additional_kwargs={}, response_metadata={}), AIMessage(content=&#39;Elon Musk is a billionaire entrepreneur, inventor, and industrial designer&#39;, additional_kwargs={}, response_metadata={}), HumanMessage(content=&#39;Translate your answer to ä¸­æ–‡.&#39;, additional_kwargs={}, response_metadata={})]</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">result <span class="token operator">=</span> llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>messages<span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">åŸƒéš†Â·é©¬æ–¯å…‹æ˜¯äº¿ä¸‡å¯Œç¿ä¼ä¸šå®¶ã€å‘æ˜å®¶å’Œå·¥ä¸šè®¾è®¡å¸ˆã€‚</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>âœ… <strong>Tip:</strong> åˆ’é‡ç‚¹ï¼šæŠŠPromptæ¨¡æ¿çœ‹ä½œå¸¦æœ‰å‚æ•°çš„å‡½æ•°</p></blockquote><h3 id="_1-2-2ã€ä»æ–‡ä»¶åŠ è½½-prompt-æ¨¡æ¿" tabindex="-1"><a class="header-anchor" href="#_1-2-2ã€ä»æ–‡ä»¶åŠ è½½-prompt-æ¨¡æ¿"><span>1.2.2ã€ä»æ–‡ä»¶åŠ è½½ Prompt æ¨¡æ¿</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate</span>\n<span class="line"></span>\n<span class="line">template <span class="token operator">=</span> PromptTemplate<span class="token punctuation">.</span>from_file<span class="token punctuation">(</span><span class="token string">&quot;example_prompt_template.txt&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;===Template===&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;===Prompt===&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>topic<span class="token operator">=</span><span class="token string">&#39;é»‘è‰²å¹½é»˜&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">===Template===</span>\n<span class="line">input_variables=[&#39;topic&#39;] input_types={} partial_variables={} template=&#39;ä¸¾ä¸€ä¸ªå…³äº{topic}çš„ä¾‹å­&#39;</span>\n<span class="line">===Prompt===</span>\n<span class="line">ä¸¾ä¸€ä¸ªå…³äºé»‘è‰²å¹½é»˜çš„ä¾‹å­</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-ç»“æ„åŒ–è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#_1-3-ç»“æ„åŒ–è¾“å‡º"><span>1.3 ç»“æ„åŒ–è¾“å‡º</span></a></h3><h3 id="_1-3-1-ç›´æ¥è¾“å‡º-pydantic-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_1-3-1-ç›´æ¥è¾“å‡º-pydantic-å¯¹è±¡"><span>1.3.1 ç›´æ¥è¾“å‡º Pydantic å¯¹è±¡</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># å®šä¹‰ä½ çš„è¾“å‡ºå¯¹è±¡</span></span>\n<span class="line"><span class="token keyword">class</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>\n<span class="line">    year<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;Year&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">    month<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;Month&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">    day<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;Day&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">    era<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;BC or AD&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate<span class="token punctuation">,</span> ChatPromptTemplate<span class="token punctuation">,</span> HumanMessagePromptTemplate</span>\n<span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>output_parsers <span class="token keyword">import</span> PydanticOutputParser</span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line">model_name <span class="token operator">=</span> <span class="token string">&#39;gpt-4o-mini&#39;</span></span>\n<span class="line">temperature <span class="token operator">=</span> <span class="token number">0</span></span>\n<span class="line">llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>model_name<span class="token operator">=</span>model_name<span class="token punctuation">,</span> temperature<span class="token operator">=</span>temperature<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># å®šä¹‰ç»“æ„åŒ–è¾“å‡ºçš„æ¨¡å‹</span></span>\n<span class="line">structured_llm <span class="token operator">=</span> llm<span class="token punctuation">.</span>with_structured_output<span class="token punctuation">(</span>Date<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">template <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;æå–ç”¨æˆ·è¾“å…¥ä¸­çš„æ—¥æœŸã€‚</span>\n<span class="line">ç”¨æˆ·è¾“å…¥:</span>\n<span class="line">{query}&quot;&quot;&quot;</span></span>\n<span class="line"></span>\n<span class="line">prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span></span>\n<span class="line">    template<span class="token operator">=</span>template<span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">query <span class="token operator">=</span> <span class="token string">&quot;2023å¹´å››æœˆ6æ—¥å¤©æ°”æ™´...&quot;</span></span>\n<span class="line">input_prompt <span class="token operator">=</span> prompt<span class="token punctuation">.</span>format_prompt<span class="token punctuation">(</span>query<span class="token operator">=</span>query<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">structured_llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>input_prompt<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">Date(year=2023, month=4, day=6, era=&#39;AD&#39;)</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-3-2-è¾“å‡ºæŒ‡å®šæ ¼å¼çš„-json" tabindex="-1"><a class="header-anchor" href="#_1-3-2-è¾“å‡ºæŒ‡å®šæ ¼å¼çš„-json"><span>1.3.2 è¾“å‡ºæŒ‡å®šæ ¼å¼çš„ JSON</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">json_schema <span class="token operator">=</span> <span class="token punctuation">{</span></span>\n<span class="line">    <span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Date&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Formated date expression&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    <span class="token string">&quot;properties&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>\n<span class="line">        <span class="token string">&quot;year&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>\n<span class="line">            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">            <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;year, YYYY&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line">        <span class="token string">&quot;month&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>\n<span class="line">            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">            <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;month, MM&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line">        <span class="token string">&quot;day&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>\n<span class="line">            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">            <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;day, DD&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line">        <span class="token string">&quot;era&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>\n<span class="line">            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">            <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;BC or AD&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line">structured_llm <span class="token operator">=</span> llm<span class="token punctuation">.</span>with_structured_output<span class="token punctuation">(</span>json_schema<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">structured_llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>input_prompt<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">{&#39;year&#39;: 2023, &#39;month&#39;: 4, &#39;day&#39;: 6}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-3-3-ä½¿ç”¨-outputparser" tabindex="-1"><a class="header-anchor" href="#_1-3-3-ä½¿ç”¨-outputparser"><span>1.3.3 ä½¿ç”¨ OutputParser</span></a></h3><p><a href="https://python.langchain.com/v0.2/docs/concepts/#output-parsers" target="_blank" rel="noopener noreferrer"><code>OutputParser</code></a> å¯ä»¥æŒ‰æŒ‡å®šæ ¼å¼è§£ææ¨¡å‹çš„è¾“å‡º</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>output_parsers <span class="token keyword">import</span> JsonOutputParser</span>\n<span class="line"></span>\n<span class="line">parser <span class="token operator">=</span> JsonOutputParser<span class="token punctuation">(</span>pydantic_object<span class="token operator">=</span>Date<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span></span>\n<span class="line">    template<span class="token operator">=</span><span class="token string">&quot;æå–ç”¨æˆ·è¾“å…¥ä¸­çš„æ—¥æœŸã€‚\\nç”¨æˆ·è¾“å…¥:{query}\\n{format_instructions}&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>\n<span class="line">    partial_variables<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;format_instructions&quot;</span><span class="token punctuation">:</span> parser<span class="token punctuation">.</span>get_format_instructions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">input_prompt <span class="token operator">=</span> prompt<span class="token punctuation">.</span>format_prompt<span class="token punctuation">(</span>query<span class="token operator">=</span>query<span class="token punctuation">)</span></span>\n<span class="line">output <span class="token operator">=</span> llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>input_prompt<span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;åŸå§‹è¾“å‡º:\\n&quot;</span><span class="token operator">+</span>output<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\nè§£æå:&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">parser<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>output<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">åŸå§‹è¾“å‡º:</span>\n<span class="line">```json</span>\n<span class="line">{&quot;year&quot;: 2023, &quot;month&quot;: 4, &quot;day&quot;: 6, &quot;era&quot;: &quot;AD&quot;}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£æå: {&#39;year&#39;: 2023, &#39;month&#39;: 4, &#39;day&#39;: 6, &#39;era&#39;: &#39;AD&#39;}</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"></span>\n<span class="line">ä¹Ÿå¯ä»¥ç”¨ `PydanticOutputParser`</span>\n<span class="line"></span>\n<span class="line">```python</span>\n<span class="line">from langchain_core.output_parsers import PydanticOutputParser</span>\n<span class="line"></span>\n<span class="line">parser = PydanticOutputParser(pydantic_object=Date)</span>\n<span class="line"></span>\n<span class="line">input_prompt = prompt.format_prompt(query=query)</span>\n<span class="line">output = llm.invoke(input_prompt)</span>\n<span class="line">print(&quot;åŸå§‹è¾“å‡º:\\n&quot;+output.content)</span>\n<span class="line"></span>\n<span class="line">print(&quot;\\nè§£æå:&quot;)</span>\n<span class="line">parser.invoke(output)</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">åŸå§‹è¾“å‡º:</span>\n<span class="line">```json</span>\n<span class="line">{&quot;year&quot;: 2023, &quot;month&quot;: 4, &quot;day&quot;: 6, &quot;era&quot;: &quot;AD&quot;}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£æå: Date(year=2023, month=4, day=6, era=&#39;AD&#39;)</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"></span>\n<span class="line">`OutputFixingParser` åˆ©ç”¨å¤§æ¨¡å‹åšæ ¼å¼è‡ªåŠ¨çº é”™</span>\n<span class="line"></span>\n<span class="line">```python</span>\n<span class="line">from langchain.output_parsers import OutputFixingParser</span>\n<span class="line"></span>\n<span class="line">new_parser = OutputFixingParser.from_llm(parser=parser, llm=ChatOpenAI())</span>\n<span class="line"></span>\n<span class="line">bad_output = output.content.replace(&quot;4&quot;,&quot;å››&quot;)</span>\n<span class="line">print(&quot;PydanticOutputParser:&quot;)</span>\n<span class="line">try:</span>\n<span class="line">    parser.invoke(bad_output)</span>\n<span class="line">except Exception as e:</span>\n<span class="line">    print(e)</span>\n<span class="line"></span>\n<span class="line">print(&quot;OutputFixingParser:&quot;)</span>\n<span class="line">new_parser.invoke(bad_output)</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">PydanticOutputParser:</span>\n<span class="line">Invalid json output: ```json</span>\n<span class="line">{&quot;year&quot;: 2023, &quot;month&quot;: å››, &quot;day&quot;: 6, &quot;era&quot;: &quot;AD&quot;}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OutputFixingParser: Date(year=2023, month=4, day=6, era=&#39;AD&#39;)</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"></span>\n<span class="line">### 1.4 Function Calling</span>\n<span class="line"></span>\n<span class="line">```python</span>\n<span class="line">from langchain_core.tools import tool</span>\n<span class="line"></span>\n<span class="line">@tool</span>\n<span class="line">def add(a: int, b: int) -&gt; int:</span>\n<span class="line">    &quot;&quot;&quot;Add two integers.</span>\n<span class="line"></span>\n<span class="line">    Args:</span>\n<span class="line">        a: First integer</span>\n<span class="line">        b: Second integer</span>\n<span class="line">    &quot;&quot;&quot;</span>\n<span class="line">    return a + b</span>\n<span class="line"></span>\n<span class="line">@tool</span>\n<span class="line">def multiply(a: int, b: int) -&gt; int:</span>\n<span class="line">    &quot;&quot;&quot;Multiply two integers.</span>\n<span class="line"></span>\n<span class="line">    Args:</span>\n<span class="line">        a: First integer</span>\n<span class="line">        b: Second integer</span>\n<span class="line">    &quot;&quot;&quot;</span>\n<span class="line">    return a * b</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> json</span>\n<span class="line"></span>\n<span class="line">llm_with_tools <span class="token operator">=</span> llm<span class="token punctuation">.</span>bind_tools<span class="token punctuation">(</span><span class="token punctuation">[</span>add<span class="token punctuation">,</span> multiply<span class="token punctuation">]</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">query <span class="token operator">=</span> <span class="token string">&quot;3çš„4å€æ˜¯å¤šå°‘?&quot;</span></span>\n<span class="line">messages <span class="token operator">=</span> <span class="token punctuation">[</span>HumanMessage<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">]</span></span>\n<span class="line"></span>\n<span class="line">output <span class="token operator">=</span> llm_with_tools<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>messages<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>output<span class="token punctuation">.</span>tool_calls<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[</span>\n<span class="line">    {</span>\n<span class="line">        &quot;name&quot;: &quot;multiply&quot;,</span>\n<span class="line">        &quot;args&quot;: {</span>\n<span class="line">            &quot;a&quot;: 3,</span>\n<span class="line">            &quot;b&quot;: 4</span>\n<span class="line">        },</span>\n<span class="line">        &quot;id&quot;: &quot;call_GMsOIw8IPJMy3SrnlbroVcd3&quot;,</span>\n<span class="line">        &quot;type&quot;: &quot;tool_call&quot;</span>\n<span class="line">    }</span>\n<span class="line">]</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å›ä¼  Funtion Call çš„ç»“æœ</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>output<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">available_tools <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">:</span> add<span class="token punctuation">,</span> <span class="token string">&quot;multiply&quot;</span><span class="token punctuation">:</span> multiply<span class="token punctuation">}</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">for</span> tool_call <span class="token keyword">in</span> output<span class="token punctuation">.</span>tool_calls<span class="token punctuation">:</span></span>\n<span class="line">    selected_tool <span class="token operator">=</span> available_tools<span class="token punctuation">[</span>tool_call<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>\n<span class="line">    tool_msg <span class="token operator">=</span> selected_tool<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>tool_call<span class="token punctuation">)</span></span>\n<span class="line">    messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tool_msg<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">new_output <span class="token operator">=</span> llm_with_tools<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>messages<span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">for</span> message <span class="token keyword">in</span> messages<span class="token punctuation">:</span></span>\n<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>new_output<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">{</span>\n<span class="line">    &quot;content&quot;: &quot;3çš„4å€æ˜¯å¤šå°‘?&quot;,</span>\n<span class="line">    &quot;additional_kwargs&quot;: {},</span>\n<span class="line">    &quot;response_metadata&quot;: {},</span>\n<span class="line">    &quot;type&quot;: &quot;human&quot;,</span>\n<span class="line">    &quot;name&quot;: null,</span>\n<span class="line">    &quot;id&quot;: null,</span>\n<span class="line">    &quot;example&quot;: false</span>\n<span class="line">}</span>\n<span class="line">{</span>\n<span class="line">    &quot;content&quot;: &quot;&quot;,</span>\n<span class="line">    &quot;additional_kwargs&quot;: {</span>\n<span class="line">        &quot;tool_calls&quot;: [</span>\n<span class="line">            {</span>\n<span class="line">                &quot;id&quot;: &quot;call_GMsOIw8IPJMy3SrnlbroVcd3&quot;,</span>\n<span class="line">                &quot;function&quot;: {</span>\n<span class="line">                    &quot;arguments&quot;: &quot;{\\&quot;a\\&quot;:3,\\&quot;b\\&quot;:4}&quot;,</span>\n<span class="line">                    &quot;name&quot;: &quot;multiply&quot;</span>\n<span class="line">                },</span>\n<span class="line">                &quot;type&quot;: &quot;function&quot;</span>\n<span class="line">            }</span>\n<span class="line">        ],</span>\n<span class="line">        &quot;refusal&quot;: null</span>\n<span class="line">    },</span>\n<span class="line">    &quot;response_metadata&quot;: {</span>\n<span class="line">        &quot;token_usage&quot;: {</span>\n<span class="line">            &quot;completion_tokens&quot;: 17,</span>\n<span class="line">            &quot;prompt_tokens&quot;: 97,</span>\n<span class="line">            &quot;total_tokens&quot;: 114,</span>\n<span class="line">            &quot;prompt_tokens_details&quot;: {</span>\n<span class="line">                &quot;cached_tokens&quot;: 0</span>\n<span class="line">            },</span>\n<span class="line">            &quot;completion_tokens_details&quot;: {</span>\n<span class="line">                &quot;reasoning_tokens&quot;: 0</span>\n<span class="line">            }</span>\n<span class="line">        },</span>\n<span class="line">        &quot;model_name&quot;: &quot;gpt-4o-mini-2024-07-18&quot;,</span>\n<span class="line">        &quot;system_fingerprint&quot;: &quot;fp_e2bde53e6e&quot;,</span>\n<span class="line">        &quot;finish_reason&quot;: &quot;tool_calls&quot;,</span>\n<span class="line">        &quot;logprobs&quot;: null</span>\n<span class="line">    },</span>\n<span class="line">    &quot;type&quot;: &quot;ai&quot;,</span>\n<span class="line">    &quot;name&quot;: null,</span>\n<span class="line">    &quot;id&quot;: &quot;run-c4dffb82-95e3-45af-a371-6391092a08a8-0&quot;,</span>\n<span class="line">    &quot;example&quot;: false,</span>\n<span class="line">    &quot;tool_calls&quot;: [</span>\n<span class="line">        {</span>\n<span class="line">            &quot;name&quot;: &quot;multiply&quot;,</span>\n<span class="line">            &quot;args&quot;: {</span>\n<span class="line">                &quot;a&quot;: 3,</span>\n<span class="line">                &quot;b&quot;: 4</span>\n<span class="line">            },</span>\n<span class="line">            &quot;id&quot;: &quot;call_GMsOIw8IPJMy3SrnlbroVcd3&quot;,</span>\n<span class="line">            &quot;type&quot;: &quot;tool_call&quot;</span>\n<span class="line">        }</span>\n<span class="line">    ],</span>\n<span class="line">    &quot;invalid_tool_calls&quot;: [],</span>\n<span class="line">    &quot;usage_metadata&quot;: {</span>\n<span class="line">        &quot;input_tokens&quot;: 97,</span>\n<span class="line">        &quot;output_tokens&quot;: 17,</span>\n<span class="line">        &quot;total_tokens&quot;: 114,</span>\n<span class="line">        &quot;input_token_details&quot;: {</span>\n<span class="line">            &quot;cache_read&quot;: 0</span>\n<span class="line">        },</span>\n<span class="line">        &quot;output_token_details&quot;: {</span>\n<span class="line">            &quot;reasoning&quot;: 0</span>\n<span class="line">        }</span>\n<span class="line">    }</span>\n<span class="line">}</span>\n<span class="line">{</span>\n<span class="line">    &quot;content&quot;: &quot;12&quot;,</span>\n<span class="line">    &quot;additional_kwargs&quot;: {},</span>\n<span class="line">    &quot;response_metadata&quot;: {},</span>\n<span class="line">    &quot;type&quot;: &quot;tool&quot;,</span>\n<span class="line">    &quot;name&quot;: &quot;multiply&quot;,</span>\n<span class="line">    &quot;id&quot;: null,</span>\n<span class="line">    &quot;tool_call_id&quot;: &quot;call_GMsOIw8IPJMy3SrnlbroVcd3&quot;,</span>\n<span class="line">    &quot;artifact&quot;: null,</span>\n<span class="line">    &quot;status&quot;: &quot;success&quot;</span>\n<span class="line">}</span>\n<span class="line">3çš„4å€æ˜¯12ã€‚</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5ã€å°ç»“" tabindex="-1"><a class="header-anchor" href="#_1-5ã€å°ç»“"><span>1.5ã€å°ç»“</span></a></h3><ol><li>LangChain ç»Ÿä¸€å°è£…äº†å„ç§æ¨¡å‹çš„è°ƒç”¨æ¥å£ï¼ŒåŒ…æ‹¬è¡¥å…¨å‹å’Œå¯¹è¯å‹ä¸¤ç§</li><li>LangChain æä¾›äº† PromptTemplate ç±»ï¼Œå¯ä»¥è‡ªå®šä¹‰å¸¦å˜é‡çš„æ¨¡æ¿</li><li>LangChain æä¾›äº†ä¸€äº›åˆ—è¾“å‡ºè§£æå™¨ï¼Œç”¨äºå°†å¤§æ¨¡å‹çš„è¾“å‡ºè§£ææˆç»“æ„åŒ–å¯¹è±¡</li><li>LangChain æä¾›äº† Function Calling çš„å°è£…</li><li>ä¸Šè¿°æ¨¡å‹å±äº LangChain ä¸­è¾ƒä¸ºå®ç”¨çš„éƒ¨åˆ†</li></ol><h2 id="äºŒã€æ•°æ®è¿æ¥å°è£…" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ•°æ®è¿æ¥å°è£…"><span>äºŒã€æ•°æ®è¿æ¥å°è£…</span></a></h2><p><img src="'+i+'" alt="image"></p><h3 id="_2-1-æ–‡æ¡£åŠ è½½å™¨-document-loaders" tabindex="-1"><a class="header-anchor" href="#_2-1-æ–‡æ¡£åŠ è½½å™¨-document-loaders"><span>2.1 æ–‡æ¡£åŠ è½½å™¨ï¼šDocument Loaders</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment">#!pip install pymupdf</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>document_loaders <span class="token keyword">import</span> PyMuPDFLoader</span>\n<span class="line"></span>\n<span class="line">loader <span class="token operator">=</span> PyMuPDFLoader<span class="token punctuation">(</span><span class="token string">&quot;llama2.pdf&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">pages <span class="token operator">=</span> loader<span class="token punctuation">.</span>load_and_split<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>pages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>page_content<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">Llama 2: Open Foundation and Fine-Tuned Chat Models</span>\n<span class="line">Hugo Touvronâˆ—</span>\n<span class="line">Louis Martinâ€ </span>\n<span class="line">Kevin Stoneâ€ </span>\n<span class="line">Peter Albert Amjad Almahairi Yasmine Babaei Nikolay Bashlykov Soumya Batra</span>\n<span class="line">Prajjwal Bhargava Shruti Bhosale Dan Bikel Lukas Blecher Cristian Canton Ferrer Moya Chen</span>\n<span class="line">Guillem Cucurull David Esiobu Jude Fernandes Jeremy Fu Wenyin Fu Brian Fuller</span>\n<span class="line">Cynthia Gao Vedanuj Goswami Naman Goyal Anthony Hartshorn Saghar Hosseini Rui Hou</span>\n<span class="line">Hakan Inan Marcin Kardas Viktor Kerkez Madian Khabsa Isabel Kloumann Artem Korenev</span>\n<span class="line">Punit Singh Koura Marie-Anne Lachaux Thibaut Lavril Jenya Lee Diana Liskovich</span>\n<span class="line">Yinghai Lu Yuning Mao Xavier Martinet Todor Mihaylov Pushkar Mishra</span>\n<span class="line">Igor Molybog Yixin Nie Andrew Poulton Jeremy Reizenstein Rashi Rungta Kalyan Saladi</span>\n<span class="line">Alan Schelten Ruan Silva Eric Michael Smith Ranjan Subramanian Xiaoqing Ellen Tan Binh Tang</span>\n<span class="line">Ross Taylor Adina Williams Jian Xiang Kuan Puxin Xu Zheng Yan Iliyan Zarov Yuchen Zhang</span>\n<span class="line">Angela Fan Melanie Kambadur Sharan Narang Aurelien Rodriguez Robert Stojnic</span>\n<span class="line">Sergey Edunov</span>\n<span class="line">Thomas Scialomâˆ—</span>\n<span class="line">GenAI, Meta</span>\n<span class="line">Abstract</span>\n<span class="line">In this work, we develop and release Llama 2, a collection of pretrained and ï¬ne-tuned</span>\n<span class="line">large language models (LLMs) ranging in scale from 7 billion to 70 billion parameters.</span>\n<span class="line">Our ï¬ne-tuned LLMs, called Llama 2-Chat, are optimized for dialogue use cases. Our</span>\n<span class="line">models outperform open-source chat models on most benchmarks we tested, and based on</span>\n<span class="line">our human evaluations for helpfulness and safety, may be a suitable substitute for closed-</span>\n<span class="line">source models. We provide a detailed description of our approach to ï¬ne-tuning and safety</span>\n<span class="line">improvements of Llama 2-Chat in order to enable the community to build on our work and</span>\n<span class="line">contribute to the responsible development of LLMs.</span>\n<span class="line">âˆ—Equal contribution, corresponding authors: {tscialom, htouvron}@meta.com</span>\n<span class="line">â€ Second author</span>\n<span class="line">Contributions for all the authors can be found in Section A.1.</span>\n<span class="line">arXiv:2307.09288v2  [cs.CL]  19 Jul 2023</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-æ–‡æ¡£å¤„ç†å™¨" tabindex="-1"><a class="header-anchor" href="#_2-2-æ–‡æ¡£å¤„ç†å™¨"><span>2.2 æ–‡æ¡£å¤„ç†å™¨</span></a></h3><h3 id="_2-2-1-textsplitter" tabindex="-1"><a class="header-anchor" href="#_2-2-1-textsplitter"><span>2.2.1 TextSplitter</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment">#!pip install --upgrade langchain-text-splitters</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_text_splitters <span class="token keyword">import</span> RecursiveCharacterTextSplitter</span>\n<span class="line"></span>\n<span class="line">text_splitter <span class="token operator">=</span> RecursiveCharacterTextSplitter<span class="token punctuation">(</span></span>\n<span class="line">    chunk_size<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span></span>\n<span class="line">    chunk_overlap<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> </span>\n<span class="line">    length_function<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">,</span></span>\n<span class="line">    add_start_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">paragraphs <span class="token operator">=</span> text_splitter<span class="token punctuation">.</span>create_documents<span class="token punctuation">(</span><span class="token punctuation">[</span>pages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>page_content<span class="token punctuation">]</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">for</span> para <span class="token keyword">in</span> paragraphs<span class="token punctuation">:</span></span>\n<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>para<span class="token punctuation">.</span>page_content<span class="token punctuation">)</span></span>\n<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;-------&#39;</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">Llama 2: Open Foundation and Fine-Tuned Chat Models</span>\n<span class="line">Hugo Touvronâˆ—</span>\n<span class="line">Louis Martinâ€ </span>\n<span class="line">Kevin Stoneâ€ </span>\n<span class="line">Peter Albert Amjad Almahairi Yasmine Babaei Nikolay Bashlykov Soumya Batra</span>\n<span class="line">-------</span>\n<span class="line">Kevin Stoneâ€ </span>\n<span class="line">Peter Albert Amjad Almahairi Yasmine Babaei Nikolay Bashlykov Soumya Batra</span>\n<span class="line">Prajjwal Bhargava Shruti Bhosale Dan Bikel Lukas Blecher Cristian Canton Ferrer Moya Chen</span>\n<span class="line">-------</span>\n<span class="line">Prajjwal Bhargava Shruti Bhosale Dan Bikel Lukas Blecher Cristian Canton Ferrer Moya Chen</span>\n<span class="line">Guillem Cucurull David Esiobu Jude Fernandes Jeremy Fu Wenyin Fu Brian Fuller</span>\n<span class="line">-------</span>\n<span class="line">Guillem Cucurull David Esiobu Jude Fernandes Jeremy Fu Wenyin Fu Brian Fuller</span>\n<span class="line">Cynthia Gao Vedanuj Goswami Naman Goyal Anthony Hartshorn Saghar Hosseini Rui Hou</span>\n<span class="line">-------</span>\n<span class="line">Cynthia Gao Vedanuj Goswami Naman Goyal Anthony Hartshorn Saghar Hosseini Rui Hou</span>\n<span class="line">Hakan Inan Marcin Kardas Viktor Kerkez Madian Khabsa Isabel Kloumann Artem Korenev</span>\n<span class="line">-------</span>\n<span class="line">Hakan Inan Marcin Kardas Viktor Kerkez Madian Khabsa Isabel Kloumann Artem Korenev</span>\n<span class="line">Punit Singh Koura Marie-Anne Lachaux Thibaut Lavril Jenya Lee Diana Liskovich</span>\n<span class="line">-------</span>\n<span class="line">Punit Singh Koura Marie-Anne Lachaux Thibaut Lavril Jenya Lee Diana Liskovich</span>\n<span class="line">Yinghai Lu Yuning Mao Xavier Martinet Todor Mihaylov Pushkar Mishra</span>\n<span class="line">-------</span>\n<span class="line">Yinghai Lu Yuning Mao Xavier Martinet Todor Mihaylov Pushkar Mishra</span>\n<span class="line">Igor Molybog Yixin Nie Andrew Poulton Jeremy Reizenstein Rashi Rungta Kalyan Saladi</span>\n<span class="line">-------</span>\n<span class="line">Igor Molybog Yixin Nie Andrew Poulton Jeremy Reizenstein Rashi Rungta Kalyan Saladi</span>\n<span class="line">Alan Schelten Ruan Silva Eric Michael Smith Ranjan Subramanian Xiaoqing Ellen Tan Binh Tang</span>\n<span class="line">-------</span>\n<span class="line">Alan Schelten Ruan Silva Eric Michael Smith Ranjan Subramanian Xiaoqing Ellen Tan Binh Tang</span>\n<span class="line">Ross Taylor Adina Williams Jian Xiang Kuan Puxin Xu Zheng Yan Iliyan Zarov Yuchen Zhang</span>\n<span class="line">-------</span>\n<span class="line">Ross Taylor Adina Williams Jian Xiang Kuan Puxin Xu Zheng Yan Iliyan Zarov Yuchen Zhang</span>\n<span class="line">Angela Fan Melanie Kambadur Sharan Narang Aurelien Rodriguez Robert Stojnic</span>\n<span class="line">Sergey Edunov</span>\n<span class="line">Thomas Scialomâˆ—</span>\n<span class="line">-------</span>\n<span class="line">Sergey Edunov</span>\n<span class="line">Thomas Scialomâˆ—</span>\n<span class="line">GenAI, Meta</span>\n<span class="line">Abstract</span>\n<span class="line">In this work, we develop and release Llama 2, a collection of pretrained and ï¬ne-tuned</span>\n<span class="line">-------</span>\n<span class="line">Abstract</span>\n<span class="line">In this work, we develop and release Llama 2, a collection of pretrained and ï¬ne-tuned</span>\n<span class="line">large language models (LLMs) ranging in scale from 7 billion to 70 billion parameters.</span>\n<span class="line">-------</span>\n<span class="line">large language models (LLMs) ranging in scale from 7 billion to 70 billion parameters.</span>\n<span class="line">Our ï¬ne-tuned LLMs, called Llama 2-Chat, are optimized for dialogue use cases. Our</span>\n<span class="line">-------</span>\n<span class="line">Our ï¬ne-tuned LLMs, called Llama 2-Chat, are optimized for dialogue use cases. Our</span>\n<span class="line">models outperform open-source chat models on most benchmarks we tested, and based on</span>\n<span class="line">-------</span>\n<span class="line">models outperform open-source chat models on most benchmarks we tested, and based on</span>\n<span class="line">our human evaluations for helpfulness and safety, may be a suitable substitute for closed-</span>\n<span class="line">-------</span>\n<span class="line">our human evaluations for helpfulness and safety, may be a suitable substitute for closed-</span>\n<span class="line">source models. We provide a detailed description of our approach to ï¬ne-tuning and safety</span>\n<span class="line">-------</span>\n<span class="line">source models. We provide a detailed description of our approach to ï¬ne-tuning and safety</span>\n<span class="line">improvements of Llama 2-Chat in order to enable the community to build on our work and</span>\n<span class="line">-------</span>\n<span class="line">improvements of Llama 2-Chat in order to enable the community to build on our work and</span>\n<span class="line">contribute to the responsible development of LLMs.</span>\n<span class="line">-------</span>\n<span class="line">contribute to the responsible development of LLMs.</span>\n<span class="line">âˆ—Equal contribution, corresponding authors: {tscialom, htouvron}@meta.com</span>\n<span class="line">â€ Second author</span>\n<span class="line">-------</span>\n<span class="line">âˆ—Equal contribution, corresponding authors: {tscialom, htouvron}@meta.com</span>\n<span class="line">â€ Second author</span>\n<span class="line">Contributions for all the authors can be found in Section A.1.</span>\n<span class="line">arXiv:2307.09288v2  [cs.CL]  19 Jul 2023</span>\n<span class="line">-------</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>â„¹ï¸ <strong>Info:</strong> ç±»ä¼¼ LlamaIndexï¼ŒLangChain ä¹Ÿæä¾›äº†ä¸°å¯Œçš„ Document Loaders å’Œ Text Splittersã€‚</p></blockquote><h3 id="_2-3ã€å‘é‡æ•°æ®åº“ä¸å‘é‡æ£€ç´¢" tabindex="-1"><a class="header-anchor" href="#_2-3ã€å‘é‡æ•°æ®åº“ä¸å‘é‡æ£€ç´¢"><span>2.3ã€å‘é‡æ•°æ®åº“ä¸å‘é‡æ£€ç´¢</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> OpenAIEmbeddings</span>\n<span class="line"><span class="token keyword">from</span> langchain_text_splitters <span class="token keyword">import</span> RecursiveCharacterTextSplitter</span>\n<span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>vectorstores <span class="token keyword">import</span> FAISS</span>\n<span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>document_loaders <span class="token keyword">import</span> PyMuPDFLoader</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># åŠ è½½æ–‡æ¡£</span></span>\n<span class="line">loader <span class="token operator">=</span> PyMuPDFLoader<span class="token punctuation">(</span><span class="token string">&quot;llama2.pdf&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">pages <span class="token operator">=</span> loader<span class="token punctuation">.</span>load_and_split<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æ–‡æ¡£åˆ‡åˆ†</span></span>\n<span class="line">text_splitter <span class="token operator">=</span> RecursiveCharacterTextSplitter<span class="token punctuation">(</span></span>\n<span class="line">    chunk_size<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span></span>\n<span class="line">    chunk_overlap<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span></span>\n<span class="line">    length_function<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">,</span></span>\n<span class="line">    add_start_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">texts <span class="token operator">=</span> text_splitter<span class="token punctuation">.</span>create_documents<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">[</span>page<span class="token punctuation">.</span>page_content <span class="token keyword">for</span> page <span class="token keyword">in</span> pages<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># çŒåº“</span></span>\n<span class="line">embeddings <span class="token operator">=</span> OpenAIEmbeddings<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;text-embedding-ada-002&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">db <span class="token operator">=</span> FAISS<span class="token punctuation">.</span>from_documents<span class="token punctuation">(</span>texts<span class="token punctuation">,</span> embeddings<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æ£€ç´¢ top-3 ç»“æœ</span></span>\n<span class="line">retriever <span class="token operator">=</span> db<span class="token punctuation">.</span>as_retriever<span class="token punctuation">(</span>search_kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;k&quot;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">docs <span class="token operator">=</span> retriever<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token string">&quot;llama2æœ‰å¤šå°‘å‚æ•°&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">for</span> doc <span class="token keyword">in</span> docs<span class="token punctuation">:</span></span>\n<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>page_content<span class="token punctuation">)</span></span>\n<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;----&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">but are not releasing.Â§</span>\n<span class="line">2. Llama 2-Chat, a ï¬ne-tuned version of Llama 2 that is optimized for dialogue use cases. We release</span>\n<span class="line">variants of this model with 7B, 13B, and 70B parameters as well.</span>\n<span class="line">We believe that the open release of LLMs, when done safely, will be a net beneï¬t to society. Like all LLMs,</span>\n<span class="line">----</span>\n<span class="line">Llama 2-Chat, at scales up to 70B parameters. On the series of helpfulness and safety benchmarks we tested,</span>\n<span class="line">Llama 2-Chat models generally perform better than existing open-source models. They also appear to</span>\n<span class="line">----</span>\n<span class="line">large language models (LLMs) ranging in scale from 7 billion to 70 billion parameters.</span>\n<span class="line">Our ï¬ne-tuned LLMs, called Llama 2-Chat, are optimized for dialogue use cases. Our</span>\n<span class="line">models outperform open-source chat models on most benchmarks we tested, and based on</span>\n<span class="line">----</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ›´å¤šçš„ä¸‰æ–¹æ£€ç´¢ç»„ä»¶é“¾æ¥ï¼Œå‚è€ƒï¼šhttps://python.langchain.com/v0.2/docs/integrations/vectorstores/</p><h3 id="_2-4ã€å°ç»“" tabindex="-1"><a class="header-anchor" href="#_2-4ã€å°ç»“"><span>2.4ã€å°ç»“</span></a></h3><ol><li>æ–‡æ¡£å¤„ç†éƒ¨åˆ†ï¼Œå»ºè®®åœ¨å®é™…åº”ç”¨ä¸­è¯¦ç»†æµ‹è¯•åä½¿ç”¨</li><li>ä¸å‘é‡æ•°æ®åº“çš„é“¾æ¥éƒ¨åˆ†æœ¬è´¨æ˜¯æ¥å£å°è£…ï¼Œå‘é‡æ•°æ®åº“éœ€è¦è‡ªå·±é€‰å‹</li></ol><h2 id="ä¸‰ã€å¯¹è¯å†å²ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å¯¹è¯å†å²ç®¡ç†"><span>ä¸‰ã€å¯¹è¯å†å²ç®¡ç†</span></a></h2><h3 id="_3-1ã€å†å²è®°å½•çš„å‰ªè£" tabindex="-1"><a class="header-anchor" href="#_3-1ã€å†å²è®°å½•çš„å‰ªè£"><span>3.1ã€å†å²è®°å½•çš„å‰ªè£</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>messages <span class="token keyword">import</span> <span class="token punctuation">(</span></span>\n<span class="line">    AIMessage<span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">,</span></span>\n<span class="line">    SystemMessage<span class="token punctuation">,</span></span>\n<span class="line">    trim_messages<span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"></span>\n<span class="line">messages <span class="token operator">=</span> <span class="token punctuation">[</span></span>\n<span class="line">    SystemMessage<span class="token punctuation">(</span><span class="token string">&quot;you&#39;re a good assistant, you always respond with a joke.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">(</span><span class="token string">&quot;i wonder why it&#39;s called langchain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    AIMessage<span class="token punctuation">(</span></span>\n<span class="line">        <span class="token string">&#39;Well, I guess they thought &quot;WordRope&quot; and &quot;SentenceString&quot; just didn\\&#39;t have the same ring to it!&#39;</span></span>\n<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">(</span><span class="token string">&quot;and who is harrison chasing anyways&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    AIMessage<span class="token punctuation">(</span></span>\n<span class="line">        <span class="token string">&quot;Hmmm let me think.\\n\\nWhy, he&#39;s probably chasing after the last cup of coffee in the office!&quot;</span></span>\n<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">(</span><span class="token string">&quot;what do you call a speechless parrot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">]</span></span>\n<span class="line"></span>\n<span class="line">trim_messages<span class="token punctuation">(</span></span>\n<span class="line">    messages<span class="token punctuation">,</span></span>\n<span class="line">    max_tokens<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span></span>\n<span class="line">    strategy<span class="token operator">=</span><span class="token string">&quot;last&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    token_counter<span class="token operator">=</span>ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;gpt-4o-mini&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[AIMessage(content=&quot;Hmmm let me think.\\n\\nWhy, he&#39;s probably chasing after the last cup of coffee in the office!&quot;, additional_kwargs={}, response_metadata={}),</span>\n<span class="line"> HumanMessage(content=&#39;what do you call a speechless parrot&#39;, additional_kwargs={}, response_metadata={})]</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># ä¿ç•™ system prompt</span></span>\n<span class="line">trim_messages<span class="token punctuation">(</span></span>\n<span class="line">    messages<span class="token punctuation">,</span></span>\n<span class="line">    max_tokens<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span></span>\n<span class="line">    strategy<span class="token operator">=</span><span class="token string">&quot;last&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    token_counter<span class="token operator">=</span>ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;gpt-4o-mini&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    include_system<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>\n<span class="line">    allow_partial<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[SystemMessage(content=&quot;you&#39;re a good assistant, you always respond with a joke.&quot;, additional_kwargs={}, response_metadata={}),</span>\n<span class="line"> HumanMessage(content=&#39;what do you call a speechless parrot&#39;, additional_kwargs={}, response_metadata={})]</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2ã€è¿‡æ»¤å¸¦æ ‡è¯†çš„å†å²è®°å½•" tabindex="-1"><a class="header-anchor" href="#_3-2ã€è¿‡æ»¤å¸¦æ ‡è¯†çš„å†å²è®°å½•"><span>3.2ã€è¿‡æ»¤å¸¦æ ‡è¯†çš„å†å²è®°å½•</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>messages <span class="token keyword">import</span> <span class="token punctuation">(</span></span>\n<span class="line">    AIMessage<span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">,</span></span>\n<span class="line">    SystemMessage<span class="token punctuation">,</span></span>\n<span class="line">    filter_messages<span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">messages <span class="token operator">=</span> <span class="token punctuation">[</span></span>\n<span class="line">    SystemMessage<span class="token punctuation">(</span><span class="token string">&quot;you are a good assistant&quot;</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">(</span><span class="token string">&quot;example input&quot;</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;example_user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    AIMessage<span class="token punctuation">(</span><span class="token string">&quot;example output&quot;</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;example_assistant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    HumanMessage<span class="token punctuation">(</span><span class="token string">&quot;real input&quot;</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    AIMessage<span class="token punctuation">(</span><span class="token string">&quot;real output&quot;</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">]</span></span>\n<span class="line"></span>\n<span class="line">filter_messages<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> include_types<span class="token operator">=</span><span class="token string">&quot;human&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[HumanMessage(content=&#39;example input&#39;, additional_kwargs={}, response_metadata={}, name=&#39;example_user&#39;, id=&#39;2&#39;),</span>\n<span class="line"> HumanMessage(content=&#39;real input&#39;, additional_kwargs={}, response_metadata={}, name=&#39;bob&#39;, id=&#39;4&#39;)]</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">filter_messages<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> exclude_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;example_user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example_assistant&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[SystemMessage(content=&#39;you are a good assistant&#39;, additional_kwargs={}, response_metadata={}, id=&#39;1&#39;),</span>\n<span class="line"> HumanMessage(content=&#39;real input&#39;, additional_kwargs={}, response_metadata={}, name=&#39;bob&#39;, id=&#39;4&#39;),</span>\n<span class="line"> AIMessage(content=&#39;real output&#39;, additional_kwargs={}, response_metadata={}, name=&#39;alice&#39;, id=&#39;5&#39;)]</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">filter_messages<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> include_types<span class="token operator">=</span><span class="token punctuation">[</span>HumanMessage<span class="token punctuation">,</span> AIMessage<span class="token punctuation">]</span><span class="token punctuation">,</span> exclude_ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[HumanMessage(content=&#39;example input&#39;, additional_kwargs={}, response_metadata={}, name=&#39;example_user&#39;, id=&#39;2&#39;),</span>\n<span class="line"> HumanMessage(content=&#39;real input&#39;, additional_kwargs={}, response_metadata={}, name=&#39;bob&#39;, id=&#39;4&#39;),</span>\n<span class="line"> AIMessage(content=&#39;real output&#39;, additional_kwargs={}, response_metadata={}, name=&#39;alice&#39;, id=&#39;5&#39;)]</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>â„¹ï¸ <strong>Info:</strong> æ€è€ƒï¼šä½ èƒ½æƒ³å‡ºè¿™ä¸ªåŠŸèƒ½çš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯å—ï¼Ÿ</p></blockquote><h2 id="å››ã€chain-å’Œ-langchain-expression-language-lcel" tabindex="-1"><a class="header-anchor" href="#å››ã€chain-å’Œ-langchain-expression-language-lcel"><span>å››ã€Chain å’Œ LangChain Expression Language (LCEL)</span></a></h2><p>LangChain Expression Languageï¼ˆLCELï¼‰æ˜¯ä¸€ç§å£°æ˜å¼è¯­è¨€ï¼Œå¯è½»æ¾ç»„åˆä¸åŒçš„è°ƒç”¨é¡ºåºæ„æˆ Chainã€‚LCEL è‡ªåˆ›ç«‹ä¹‹åˆå°±è¢«è®¾è®¡ä¸ºèƒ½å¤Ÿæ”¯æŒå°†åŸå‹æŠ•å…¥ç”Ÿäº§ç¯å¢ƒï¼Œ<strong>æ— éœ€ä»£ç æ›´æ”¹</strong>ï¼Œä»æœ€ç®€å•çš„â€œæç¤º+LLMâ€é“¾åˆ°æœ€å¤æ‚çš„é“¾ï¼ˆå·²æœ‰ç”¨æˆ·æˆåŠŸåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡ŒåŒ…å«æ•°ç™¾ä¸ªæ­¥éª¤çš„ LCEL Chainï¼‰ã€‚</p><p>LCEL çš„ä¸€äº›äº®ç‚¹åŒ…æ‹¬ï¼š</p><ol><li><p><strong>æµæ”¯æŒ</strong>ï¼šä½¿ç”¨ LCEL æ„å»º Chain æ—¶ï¼Œä½ å¯ä»¥è·å¾—æœ€ä½³çš„é¦–ä¸ªä»¤ç‰Œæ—¶é—´ï¼ˆå³ä»è¾“å‡ºå¼€å§‹åˆ°é¦–æ‰¹è¾“å‡ºç”Ÿæˆçš„æ—¶é—´ï¼‰ã€‚å¯¹äºæŸäº› Chainï¼Œè¿™æ„å‘³ç€å¯ä»¥ç›´æ¥ä» LLM æµå¼ä¼ è¾“ä»¤ç‰Œåˆ°æµè¾“å‡ºè§£æå™¨ï¼Œä»è€Œä»¥ä¸ LLM æä¾›å•†è¾“å‡ºåŸå§‹ä»¤ç‰Œç›¸åŒçš„é€Ÿç‡è·å¾—è§£æåçš„ã€å¢é‡çš„è¾“å‡ºã€‚</p></li><li><p><strong>å¼‚æ­¥æ”¯æŒ</strong>ï¼šä»»ä½•ä½¿ç”¨ LCEL æ„å»ºçš„é“¾æ¡éƒ½å¯ä»¥é€šè¿‡åŒæ­¥ APIï¼ˆä¾‹å¦‚ï¼Œåœ¨ Jupyter ç¬”è®°æœ¬ä¸­è¿›è¡ŒåŸå‹è®¾è®¡æ—¶ï¼‰å’Œå¼‚æ­¥ APIï¼ˆä¾‹å¦‚ï¼Œåœ¨ LangServe æœåŠ¡å™¨ä¸­ï¼‰è°ƒç”¨ã€‚è¿™ä½¿å¾—ç›¸åŒçš„ä»£ç å¯ç”¨äºåŸå‹è®¾è®¡å’Œç”Ÿäº§ç¯å¢ƒï¼Œå…·æœ‰å‡ºè‰²çš„æ€§èƒ½ï¼Œå¹¶èƒ½å¤Ÿåœ¨åŒä¸€æœåŠ¡å™¨ä¸­å¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚ã€‚</p></li><li><p><strong>ä¼˜åŒ–çš„å¹¶è¡Œæ‰§è¡Œ</strong>ï¼šå½“ä½ çš„ LCEL é“¾æ¡æœ‰å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„æ­¥éª¤æ—¶ï¼ˆä¾‹å¦‚ï¼Œä»å¤šä¸ªæ£€ç´¢å™¨ä¸­è·å–æ–‡æ¡£ï¼‰ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ— è®ºæ˜¯åœ¨åŒæ­¥è¿˜æ˜¯å¼‚æ­¥æ¥å£ä¸­ï¼Œä»¥å®ç°æœ€å°çš„å»¶è¿Ÿã€‚</p></li><li><p><strong>é‡è¯•å’Œå›é€€</strong>ï¼šä¸º LCEL é“¾çš„ä»»ä½•éƒ¨åˆ†é…ç½®é‡è¯•å’Œå›é€€ã€‚è¿™æ˜¯ä½¿é“¾åœ¨è§„æ¨¡ä¸Šæ›´å¯é çš„ç»ä½³æ–¹å¼ã€‚ç›®å‰æˆ‘ä»¬æ­£åœ¨æ·»åŠ é‡è¯•/å›é€€çš„æµåª’ä½“æ”¯æŒï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä¸å¢åŠ ä»»ä½•å»¶è¿Ÿæˆæœ¬çš„æƒ…å†µä¸‹è·å¾—å¢åŠ çš„å¯é æ€§ã€‚</p></li><li><p><strong>è®¿é—®ä¸­é—´ç»“æœ</strong>ï¼šå¯¹äºæ›´å¤æ‚çš„é“¾æ¡ï¼Œè®¿é—®åœ¨æœ€ç»ˆè¾“å‡ºäº§ç”Ÿä¹‹å‰çš„ä¸­é—´æ­¥éª¤çš„ç»“æœé€šå¸¸éå¸¸æœ‰ç”¨ã€‚è¿™å¯ä»¥ç”¨äºè®©æœ€ç»ˆç”¨æˆ·çŸ¥é“æ­£åœ¨å‘ç”Ÿä¸€äº›äº‹æƒ…ï¼Œç”šè‡³ä»…ç”¨äºè°ƒè¯•é“¾æ¡ã€‚ä½ å¯ä»¥æµå¼ä¼ è¾“ä¸­é—´ç»“æœï¼Œå¹¶ä¸”åœ¨æ¯ä¸ª LangServe æœåŠ¡å™¨ä¸Šéƒ½å¯ç”¨ã€‚</p></li><li><p><strong>è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼</strong>ï¼šè¾“å…¥å’Œè¾“å‡ºæ¨¡å¼ä¸ºæ¯ä¸ª LCEL é“¾æä¾›äº†ä»é“¾çš„ç»“æ„æ¨æ–­å‡ºçš„ Pydantic å’Œ JSONSchema æ¨¡å¼ã€‚è¿™å¯ä»¥ç”¨äºè¾“å…¥å’Œè¾“å‡ºçš„éªŒè¯ï¼Œæ˜¯ LangServe çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚</p></li><li><p><strong>æ— ç¼ LangSmith è·Ÿè¸ªé›†æˆ</strong>ï¼šéšç€é“¾æ¡å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œç†è§£æ¯ä¸€æ­¥å‘ç”Ÿäº†ä»€ä¹ˆå˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚é€šè¿‡ LCELï¼Œæ‰€æœ‰æ­¥éª¤éƒ½è‡ªåŠ¨è®°å½•åˆ° LangSmithï¼Œä»¥å®ç°æœ€å¤§çš„å¯è§‚å¯Ÿæ€§å’Œå¯è°ƒè¯•æ€§ã€‚</p></li><li><p><strong>æ— ç¼ LangServe éƒ¨ç½²é›†æˆ</strong>ï¼šä»»ä½•ä½¿ç”¨ LCEL åˆ›å»ºçš„é“¾éƒ½å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ LangServe è¿›è¡Œéƒ¨ç½²ã€‚</p></li></ol><p>åŸæ–‡ï¼šhttps://python.langchain.com/docs/expression_language/</p><h3 id="_4-1-pipeline-å¼è°ƒç”¨-prompttemplate-llm-å’Œ-outputparser" tabindex="-1"><a class="header-anchor" href="#_4-1-pipeline-å¼è°ƒç”¨-prompttemplate-llm-å’Œ-outputparser"><span>4.1 Pipeline å¼è°ƒç”¨ PromptTemplate, LLM å’Œ OutputParser</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> ChatPromptTemplate</span>\n<span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>output_parsers <span class="token keyword">import</span> StrOutputParser</span>\n<span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>runnables <span class="token keyword">import</span> RunnablePassthrough</span>\n<span class="line"><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field<span class="token punctuation">,</span> validator</span>\n<span class="line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict<span class="token punctuation">,</span> Optional</span>\n<span class="line"><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum</span>\n<span class="line"><span class="token keyword">import</span> json</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># è¾“å‡ºç»“æ„</span></span>\n<span class="line"><span class="token keyword">class</span> <span class="token class-name">SortEnum</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> Enum<span class="token punctuation">)</span><span class="token punctuation">:</span></span>\n<span class="line">    data <span class="token operator">=</span> <span class="token string">&#39;data&#39;</span></span>\n<span class="line">    price <span class="token operator">=</span> <span class="token string">&#39;price&#39;</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">class</span> <span class="token class-name">OrderingEnum</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> Enum<span class="token punctuation">)</span><span class="token punctuation">:</span></span>\n<span class="line">    ascend <span class="token operator">=</span> <span class="token string">&#39;ascend&#39;</span></span>\n<span class="line">    descend <span class="token operator">=</span> <span class="token string">&#39;descend&#39;</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">class</span> <span class="token class-name">Semantics</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>\n<span class="line">    name<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;æµé‡åŒ…åç§°&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>\n<span class="line">    price_lower<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;ä»·æ ¼ä¸‹é™&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>\n<span class="line">    price_upper<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;ä»·æ ¼ä¸Šé™&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>\n<span class="line">    data_lower<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;æµé‡ä¸‹é™&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>\n<span class="line">    data_upper<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;æµé‡ä¸Šé™&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>\n<span class="line">    sort_by<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>SortEnum<span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;æŒ‰ä»·æ ¼æˆ–æµé‡æ’åº&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>\n<span class="line">    ordering<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>OrderingEnum<span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span></span>\n<span class="line">        description<span class="token operator">=</span><span class="token string">&quot;å‡åºæˆ–é™åºæ’åˆ—&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Prompt æ¨¡æ¿</span></span>\n<span class="line">prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">[</span></span>\n<span class="line">        <span class="token punctuation">(</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ä½ æ˜¯ä¸€ä¸ªè¯­ä¹‰è§£æå™¨ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ç”¨æˆ·çš„è¾“å…¥è§£ææˆJSONè¡¨ç¤ºã€‚ä¸è¦å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">        <span class="token punctuation">(</span><span class="token string">&quot;human&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;{text}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    <span class="token punctuation">]</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æ¨¡å‹</span></span>\n<span class="line">llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;gpt-4o&quot;</span><span class="token punctuation">,</span> temperature<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">structured_llm <span class="token operator">=</span> llm<span class="token punctuation">.</span>with_structured_output<span class="token punctuation">(</span>Semantics<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># LCEL è¡¨è¾¾å¼</span></span>\n<span class="line">runnable <span class="token operator">=</span> <span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> RunnablePassthrough<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">|</span> prompt <span class="token operator">|</span> structured_llm</span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># ç›´æ¥è¿è¡Œ</span></span>\n<span class="line">ret <span class="token operator">=</span> runnable<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token string">&quot;ä¸è¶…è¿‡100å…ƒçš„æµé‡å¤§çš„å¥—é¤æœ‰å“ªäº›&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span></span>\n<span class="line">    json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span></span>\n<span class="line">        ret<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">        indent <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span></span>\n<span class="line">        ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span></span>\n<span class="line">    <span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">{</span>\n<span class="line">    &quot;name&quot;: null,</span>\n<span class="line">    &quot;price_lower&quot;: null,</span>\n<span class="line">    &quot;price_upper&quot;: 100,</span>\n<span class="line">    &quot;data_lower&quot;: null,</span>\n<span class="line">    &quot;data_upper&quot;: null,</span>\n<span class="line">    &quot;sort_by&quot;: &quot;data&quot;,</span>\n<span class="line">    &quot;ordering&quot;: &quot;descend&quot;</span>\n<span class="line">}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æµå¼è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#æµå¼è¾“å‡º"><span>æµå¼è¾“å‡º</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span><span class="token string">&quot;è®²ä¸ªå…³äº{topic}çš„ç¬‘è¯&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">runnable <span class="token operator">=</span> <span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token punctuation">:</span> RunnablePassthrough<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">|</span> prompt <span class="token operator">|</span> llm <span class="token operator">|</span> StrOutputParser<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æµå¼è¾“å‡º</span></span>\n<span class="line"><span class="token keyword">for</span> s <span class="token keyword">in</span> runnable<span class="token punctuation">.</span>stream<span class="token punctuation">(</span><span class="token string">&quot;å°æ˜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> flush<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">å°æ˜åœ¨è¯¾å ‚ä¸Šï¼Œè€å¸ˆé—®ï¼šâ€œå¦‚æœåœ°çƒæ˜¯ä¸€ä¸ªè‹¹æœï¼Œä½ ä»¬è§‰å¾—æˆ‘ä»¬ç”Ÿæ´»åœ¨è‹¹æœçš„å“ªä¸ªéƒ¨åˆ†ï¼Ÿâ€</span>\n<span class="line"></span>\n<span class="line">å°æ˜ä¸¾æ‰‹å›ç­”ï¼šâ€œè€å¸ˆï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬ç”Ÿæ´»åœ¨è‹¹æœçš„WiFiä¿¡å·æœ€å·®çš„åœ°æ–¹ï¼â€</span>\n<span class="line"></span>\n<span class="line">è€å¸ˆæ„£äº†ä¸€ä¸‹ï¼Œé—®ï¼šâ€œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿâ€</span>\n<span class="line"></span>\n<span class="line">å°æ˜è¯´ï¼šâ€œå› ä¸ºæˆ‘åœ¨å®¶é‡Œæ€»æ˜¯æ‰¾ä¸åˆ°ä¿¡å·ï¼â€</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âš ï¸ <strong>Note:</strong> æ³¨æ„: åœ¨å½“å‰çš„æ–‡æ¡£ä¸­ LCEL äº§ç”Ÿçš„å¯¹è±¡ï¼Œè¢«å«åš runnable æˆ– chainï¼Œç»å¸¸ä¸¤ç§å«æ³•æ··ç”¨ã€‚æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰è°ƒç”¨æµç¨‹ã€‚</p></blockquote><blockquote><p>âœ… <strong>Tip:</strong> ä½¿ç”¨ LCEL çš„ä»·å€¼ï¼Œä¹Ÿå°±æ˜¯ LangChain çš„æ ¸å¿ƒä»·å€¼ã€‚ å®˜æ–¹ä»ä¸åŒè§’åº¦ç»™å‡ºäº†ä¸¾ä¾‹è¯´æ˜ï¼šhttps://python.langchain.com/v0.1/docs/expression_language/why/</p></blockquote><h3 id="_4-2-ç”¨-lcel-å®ç°-rag" tabindex="-1"><a class="header-anchor" href="#_4-2-ç”¨-lcel-å®ç°-rag"><span>4.2 ç”¨ LCEL å®ç° RAG</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> OpenAIEmbeddings</span>\n<span class="line"><span class="token keyword">from</span> langchain_text_splitters <span class="token keyword">import</span> RecursiveCharacterTextSplitter</span>\n<span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>vectorstores <span class="token keyword">import</span> FAISS</span>\n<span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>chains <span class="token keyword">import</span> RetrievalQA</span>\n<span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>document_loaders <span class="token keyword">import</span> PyMuPDFLoader</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># åŠ è½½æ–‡æ¡£</span></span>\n<span class="line">loader <span class="token operator">=</span> PyMuPDFLoader<span class="token punctuation">(</span><span class="token string">&quot;llama2.pdf&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">pages <span class="token operator">=</span> loader<span class="token punctuation">.</span>load_and_split<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æ–‡æ¡£åˆ‡åˆ†</span></span>\n<span class="line">text_splitter <span class="token operator">=</span> RecursiveCharacterTextSplitter<span class="token punctuation">(</span></span>\n<span class="line">    chunk_size<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span></span>\n<span class="line">    chunk_overlap<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span></span>\n<span class="line">    length_function<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">,</span></span>\n<span class="line">    add_start_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">texts <span class="token operator">=</span> text_splitter<span class="token punctuation">.</span>create_documents<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">[</span>page<span class="token punctuation">.</span>page_content <span class="token keyword">for</span> page <span class="token keyword">in</span> pages<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># çŒåº“</span></span>\n<span class="line">embeddings <span class="token operator">=</span> OpenAIEmbeddings<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;text-embedding-ada-002&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">db <span class="token operator">=</span> FAISS<span class="token punctuation">.</span>from_documents<span class="token punctuation">(</span>texts<span class="token punctuation">,</span> embeddings<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æ£€ç´¢ top-2 ç»“æœ</span></span>\n<span class="line">retriever <span class="token operator">=</span> db<span class="token punctuation">.</span>as_retriever<span class="token punctuation">(</span>search_kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;k&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>output_parser <span class="token keyword">import</span> StrOutputParser</span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>runnable <span class="token keyword">import</span> RunnablePassthrough</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Promptæ¨¡æ¿</span></span>\n<span class="line">template <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;Answer the question based only on the following context:</span>\n<span class="line">{context}</span>\n<span class="line"></span>\n<span class="line">Question: {question}</span>\n<span class="line">&quot;&quot;&quot;</span></span>\n<span class="line">prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span>template<span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Chain</span></span>\n<span class="line">rag_chain <span class="token operator">=</span> <span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;question&quot;</span><span class="token punctuation">:</span> RunnablePassthrough<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;context&quot;</span><span class="token punctuation">:</span> retriever<span class="token punctuation">}</span></span>\n<span class="line">    <span class="token operator">|</span> prompt</span>\n<span class="line">    <span class="token operator">|</span> llm</span>\n<span class="line">    <span class="token operator">|</span> StrOutputParser<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">rag_chain<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token string">&quot;Llama 2æœ‰å¤šå°‘å‚æ•°&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">&#39;Llama 2æœ‰7Bã€13Bå’Œ70Bå‚æ•°çš„å˜ä½“ã€‚&#39;</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-3-ç”¨-lcel-å®ç°å·¥å‚æ¨¡å¼-é€‰" tabindex="-1"><a class="header-anchor" href="#_4-3-ç”¨-lcel-å®ç°å·¥å‚æ¨¡å¼-é€‰"><span>4.3 ç”¨ LCEL å®ç°å·¥å‚æ¨¡å¼ï¼ˆé€‰ï¼‰</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>runnables<span class="token punctuation">.</span>utils <span class="token keyword">import</span> ConfigurableField</span>\n<span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>chat_models <span class="token keyword">import</span> QianfanChatEndpoint</span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> <span class="token punctuation">(</span></span>\n<span class="line">    ChatPromptTemplate<span class="token punctuation">,</span></span>\n<span class="line">    HumanMessagePromptTemplate<span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>schema <span class="token keyword">import</span> HumanMessage</span>\n<span class="line"><span class="token keyword">import</span> os</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æ¨¡å‹1</span></span>\n<span class="line">ernie_model <span class="token operator">=</span> QianfanChatEndpoint<span class="token punctuation">(</span></span>\n<span class="line">    qianfan_ak<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&#39;ERNIE_CLIENT_ID&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    qianfan_sk<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&#39;ERNIE_CLIENT_SECRET&#39;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æ¨¡å‹2</span></span>\n<span class="line">gpt_model <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;gpt-4o-mini&quot;</span><span class="token punctuation">,</span> temperature<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># é€šè¿‡ configurable_alternatives æŒ‰æŒ‡å®šå­—æ®µé€‰æ‹©æ¨¡å‹</span></span>\n<span class="line">model <span class="token operator">=</span> gpt_model<span class="token punctuation">.</span>configurable_alternatives<span class="token punctuation">(</span></span>\n<span class="line">    ConfigurableField<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;llm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </span>\n<span class="line">    default_key<span class="token operator">=</span><span class="token string">&quot;gpt&quot;</span><span class="token punctuation">,</span> </span>\n<span class="line">    ernie<span class="token operator">=</span>ernie_model<span class="token punctuation">,</span></span>\n<span class="line">    <span class="token comment"># claude=claude_model,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># Prompt æ¨¡æ¿</span></span>\n<span class="line">prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">[</span></span>\n<span class="line">        HumanMessagePromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span><span class="token string">&quot;{query}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line">    <span class="token punctuation">]</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># LCEL</span></span>\n<span class="line">chain <span class="token operator">=</span> <span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span> RunnablePassthrough<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> </span>\n<span class="line">    <span class="token operator">|</span> prompt</span>\n<span class="line">    <span class="token operator">|</span> model </span>\n<span class="line">    <span class="token operator">|</span> StrOutputParser<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># è¿è¡Œæ—¶æŒ‡å®šæ¨¡å‹ &quot;gpt&quot; or &quot;ernie&quot;</span></span>\n<span class="line">ret <span class="token operator">=</span> chain<span class="token punctuation">.</span>with_config<span class="token punctuation">(</span>configurable<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;llm&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;gpt&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token string">&quot;è¯·è‡ªæˆ‘ä»‹ç»&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">ä½ å¥½ï¼æˆ‘æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œæ—¨åœ¨å¸®åŠ©ä½ è§£ç­”é—®é¢˜ã€æä¾›ä¿¡æ¯å’Œæ”¯æŒå„ç§ä»»åŠ¡ã€‚æˆ‘å¯ä»¥å¤„ç†å¤šç§ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç§‘æŠ€ã€å†å²ã€æ–‡åŒ–ã€è¯­è¨€å­¦ä¹ ç­‰ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©çš„åœ°æ–¹ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ‰©å±•é˜…è¯»ï¼šä»€ä¹ˆæ˜¯<a href="https://www.runoob.com/design-pattern/factory-pattern.html" target="_blank" rel="noopener noreferrer"><strong>å·¥å‚æ¨¡å¼</strong></a>ï¼›<a href="https://www.runoob.com/design-pattern/design-pattern-intro.html" target="_blank" rel="noopener noreferrer"><strong>è®¾è®¡æ¨¡å¼</strong></a>æ¦‚è§ˆã€‚</p><blockquote><p>âš ï¸ <strong>Note:</strong> æ€è€ƒï¼šä»æ¨¡å—é—´è§£ä¾èµ–è§’åº¦ï¼ŒLCELçš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><h3 id="_4-4-å­˜å‚¨ä¸ç®¡ç†å¯¹è¯å†å²" tabindex="-1"><a class="header-anchor" href="#_4-4-å­˜å‚¨ä¸ç®¡ç†å¯¹è¯å†å²"><span>4.4 å­˜å‚¨ä¸ç®¡ç†å¯¹è¯å†å²</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>chat_message_histories <span class="token keyword">import</span> SQLChatMessageHistory</span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">def</span> <span class="token function">get_session_history</span><span class="token punctuation">(</span>session_id<span class="token punctuation">)</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token comment"># é€šè¿‡ session_id åŒºåˆ†å¯¹è¯å†å²ï¼Œå¹¶å­˜å‚¨åœ¨ sqlite æ•°æ®åº“ä¸­</span></span>\n<span class="line">    <span class="token keyword">return</span> SQLChatMessageHistory<span class="token punctuation">(</span>session_id<span class="token punctuation">,</span> <span class="token string">&quot;sqlite:///memory.db&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>messages <span class="token keyword">import</span> HumanMessage</span>\n<span class="line"><span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>runnables<span class="token punctuation">.</span>history <span class="token keyword">import</span> RunnableWithMessageHistory</span>\n<span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>output_parser <span class="token keyword">import</span> StrOutputParser</span>\n<span class="line"></span>\n<span class="line">model <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">&quot;gpt-4o-mini&quot;</span><span class="token punctuation">,</span> temperature<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">runnable <span class="token operator">=</span> model <span class="token operator">|</span> StrOutputParser<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">runnable_with_history <span class="token operator">=</span> RunnableWithMessageHistory<span class="token punctuation">(</span></span>\n<span class="line">    runnable<span class="token punctuation">,</span> <span class="token comment"># æŒ‡å®š runnable</span></span>\n<span class="line">    get_session_history<span class="token punctuation">,</span> <span class="token comment"># æŒ‡å®šè‡ªå®šä¹‰çš„å†å²ç®¡ç†æ–¹æ³•</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">runnable_with_history<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">[</span>HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;ä½ å¥½ï¼Œæˆ‘å«ç‹å“ç„¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>\n<span class="line">    config<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;configurable&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;session_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;wzr&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">&#39;ä½ å¥½ï¼Œç‹å“ç„¶ï¼å¾ˆé«˜å…´å†æ¬¡è§åˆ°ä½ ã€‚æœ‰ä»€ä¹ˆæƒ³èŠçš„æˆ–è€…éœ€è¦å¸®åŠ©çš„å‘¢ï¼Ÿ&#39;</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">runnable_with_history<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">[</span>HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;ä½ çŸ¥é“æˆ‘å«ä»€ä¹ˆåå­—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>\n<span class="line">    config<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;configurable&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;session_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;wzr&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">&#39;æ˜¯çš„ï¼Œä½ å«ç‹å“ç„¶ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ&#39;</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">runnable_with_history<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token punctuation">[</span>HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">&quot;ä½ çŸ¥é“æˆ‘å«ä»€ä¹ˆåå­—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>\n<span class="line">    config<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;configurable&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;session_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">&#39;æŠ±æ­‰ï¼Œæˆ‘æ— æ³•çŸ¥é“ä½ çš„åå­—ã€‚ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„åå­—ï¼Œæˆ–è€…å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜ï¼Œæˆ‘ä¹Ÿå¾ˆä¹æ„å¸®åŠ©ä½ ï¼&#39;</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="é€šè¿‡-lcel-è¿˜å¯ä»¥å®ç°" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡-lcel-è¿˜å¯ä»¥å®ç°"><span>é€šè¿‡ LCELï¼Œè¿˜å¯ä»¥å®ç°</span></a></h3><ol><li>é…ç½®è¿è¡Œæ—¶å˜é‡ï¼šhttps://python.langchain.com/v0.2/docs/how_to/configure/</li><li>æ•…éšœå›é€€ï¼šhttps://python.langchain.com/v0.2/docs/how_to/fallbacks</li><li>å¹¶è¡Œè°ƒç”¨ï¼šhttps://python.langchain.com/v0.2/docs/how_to/parallel/</li><li>é€»è¾‘åˆ†æ”¯ï¼šhttps://python.langchain.com/v0.2/docs/how_to/routing/</li><li>åŠ¨æ€åˆ›å»º Chain: https://python.langchain.com/v0.2/docs/how_to/dynamic_chain/</li></ol><p>æ›´å¤šä¾‹å­ï¼šhttps://python.langchain.com/v0.2/docs/how_to/lcel_cheatsheet/</p><h2 id="äº”ã€æ™ºèƒ½ä½“æ¶æ„-agent" tabindex="-1"><a class="header-anchor" href="#äº”ã€æ™ºèƒ½ä½“æ¶æ„-agent"><span>äº”ã€æ™ºèƒ½ä½“æ¶æ„ï¼šAgent</span></a></h2><h3 id="_5-1-ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“-agent" tabindex="-1"><a class="header-anchor" href="#_5-1-ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“-agent"><span>5.1 ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“ï¼ˆAgentï¼‰</span></a></h3><p>å°†å¤§è¯­è¨€æ¨¡å‹ä½œä¸ºä¸€ä¸ªæ¨ç†å¼•æ“ã€‚ç»™å®šä¸€ä¸ªä»»åŠ¡ï¼Œæ™ºèƒ½ä½“è‡ªåŠ¨ç”Ÿæˆå®Œæˆä»»åŠ¡æ‰€éœ€çš„æ­¥éª¤ï¼Œæ‰§è¡Œç›¸åº”åŠ¨ä½œï¼ˆä¾‹å¦‚é€‰æ‹©å¹¶è°ƒç”¨å·¥å…·ï¼‰ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆã€‚</p><p><img src="'+t+'" alt="image"></p><h3 id="_5-2-å…ˆå®šä¹‰ä¸€äº›å·¥å…·-tools" tabindex="-1"><a class="header-anchor" href="#_5-2-å…ˆå®šä¹‰ä¸€äº›å·¥å…·-tools"><span>5.2 å…ˆå®šä¹‰ä¸€äº›å·¥å…·ï¼šTools</span></a></h3><ul><li>å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–ä¸‰æ–¹ API</li><li>ä¹Ÿå¯ä»¥æŠŠä¸€ä¸ª Chain æˆ–è€… Agent çš„ run()ä½œä¸ºä¸€ä¸ª Tool</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>utilities <span class="token keyword">import</span> SerpAPIWrapper</span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>tools <span class="token keyword">import</span> Tool<span class="token punctuation">,</span> tool</span>\n<span class="line"></span>\n<span class="line">search <span class="token operator">=</span> SerpAPIWrapper<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line">tools <span class="token operator">=</span> <span class="token punctuation">[</span></span>\n<span class="line">    Tool<span class="token punctuation">.</span>from_function<span class="token punctuation">(</span></span>\n<span class="line">        func<span class="token operator">=</span>search<span class="token punctuation">.</span>run<span class="token punctuation">,</span></span>\n<span class="line">        name<span class="token operator">=</span><span class="token string">&quot;Search&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">        description<span class="token operator">=</span><span class="token string">&quot;useful for when you need to answer questions about current events&quot;</span></span>\n<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">]</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦æ³¨å†Œ <a href="https://serpapi.com/" target="_blank" rel="noopener noreferrer">SerpAPI</a>ï¼ˆé™é‡å…è´¹ï¼‰ï¼Œå¹¶å°† <code>SERPAPI_API_KEY</code> å†™åœ¨ç¯å¢ƒå˜é‡ä¸­</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> calendar</span>\n<span class="line"><span class="token keyword">import</span> dateutil<span class="token punctuation">.</span>parser <span class="token keyword">as</span> parser</span>\n<span class="line"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> date</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># è‡ªå®šä¹‰å·¥å…·</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span class="token decorator annotation punctuation">@tool</span><span class="token punctuation">(</span><span class="token string">&quot;weekday&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">def</span> <span class="token function">weekday</span><span class="token punctuation">(</span>date_str<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span></span>\n<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;Convert date to weekday name&quot;&quot;&quot;</span></span>\n<span class="line">    d <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>date_str<span class="token punctuation">)</span></span>\n<span class="line">    <span class="token keyword">return</span> calendar<span class="token punctuation">.</span>day_name<span class="token punctuation">[</span>d<span class="token punctuation">.</span>weekday<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line">tools <span class="token operator">+=</span> <span class="token punctuation">[</span>weekday<span class="token punctuation">]</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-æ™ºèƒ½ä½“ç±»å‹-react" tabindex="-1"><a class="header-anchor" href="#_5-3-æ™ºèƒ½ä½“ç±»å‹-react"><span>5.3 æ™ºèƒ½ä½“ç±»å‹ï¼šReAct</span></a></h3><p><img src="'+o+'" alt="image"></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># !pip install google-search-results</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># !pip install --upgrade langchainhub</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain <span class="token keyword">import</span> hub</span>\n<span class="line"><span class="token keyword">import</span> json</span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># ä¸‹è½½ä¸€ä¸ªç°æœ‰çš„ Prompt æ¨¡æ¿</span></span>\n<span class="line">react_prompt <span class="token operator">=</span> hub<span class="token punctuation">.</span>pull<span class="token punctuation">(</span><span class="token string">&quot;hwchase17/react&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>react_prompt<span class="token punctuation">.</span>template<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">Answer the following questions as best you can. You have access to the following tools:</span>\n<span class="line"></span>\n<span class="line">{tools}</span>\n<span class="line"></span>\n<span class="line">Use the following format:</span>\n<span class="line"></span>\n<span class="line">Question: the input question you must answer</span>\n<span class="line">Thought: you should always think about what to do</span>\n<span class="line">Action: the action to take, should be one of [{tool_names}]</span>\n<span class="line">Action Input: the input to the action</span>\n<span class="line">Observation: the result of the action</span>\n<span class="line">... (this Thought/Action/Action Input/Observation can repeat N times)</span>\n<span class="line">Thought: I now know the final answer</span>\n<span class="line">Final Answer: the final answer to the original input question</span>\n<span class="line"></span>\n<span class="line">Begin!</span>\n<span class="line"></span>\n<span class="line">Question: {input}</span>\n<span class="line">Thought:{agent_scratchpad}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword">import</span> AgentExecutor<span class="token punctuation">,</span> create_react_agent</span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line">llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token string">&#39;gpt-4o&#39;</span><span class="token punctuation">,</span> temperature<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> seed<span class="token operator">=</span><span class="token number">23</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># å®šä¹‰ä¸€ä¸ª agent: éœ€è¦å¤§æ¨¡å‹ã€å·¥å…·é›†ã€å’Œ Prompt æ¨¡æ¿</span></span>\n<span class="line">agent <span class="token operator">=</span> create_react_agent<span class="token punctuation">(</span>llm<span class="token punctuation">,</span> tools<span class="token punctuation">,</span> react_prompt<span class="token punctuation">)</span></span>\n<span class="line"><span class="token comment"># å®šä¹‰ä¸€ä¸ªæ‰§è¡Œå™¨ï¼šéœ€è¦ agent å¯¹è±¡ å’Œ å·¥å…·é›†</span></span>\n<span class="line">agent_executor <span class="token operator">=</span> AgentExecutor<span class="token punctuation">(</span>agent<span class="token operator">=</span>agent<span class="token punctuation">,</span> tools<span class="token operator">=</span>tools<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># æ‰§è¡Œ</span></span>\n<span class="line">agent_executor<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2024å¹´å‘¨æ°ä¼¦çš„æ¼”å”±ä¼šæ˜ŸæœŸå‡ &quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[1m&gt; Entering new AgentExecutor chain...[0m</span>\n<span class="line">[32;1m[1;3mTo determine the weekday of Jay Chou&#39;s concert in 2024, I need to know the specific date of the concert. Once I have the date, I can find out the weekday. </span>\n<span class="line"></span>\n<span class="line">Action: Search</span>\n<span class="line">Action Input: &quot;2024 Jay Chou concert dates&quot;[0m[36;1m[1;3m[&#39;Trending Performers Â· 8 events in all locations Â· Oct 11. Fri. 8:00 PM. This week. Singapore National Stadium. Singapore, Singapore Â· Oct 12. Sat. 7:30 PM.&#39;, &#39;Jay Chou Tour Dates See the Jay Chou concert schedule for 2024. Â· All Tour Dates Â· Oct. 11. 2024. Fri. Singapore National Stadium. Singapore, Singapore Â· Oct.&#39;, &#39;Unfortunately there are no concert dates for Jay Chou scheduled in 2024. Songkick is the first to know of new tour announcements and concert information, so if ...&#39;, &#39;Tour dates. edit. List of concert dates. Date, City, Country, Venue, Attendance ... ^ &quot;Jay Chou Carnival World Tour 2024 - Singapore&quot;. Singapore Sports Hub ...&#39;, &#39;Jay Chou Singapore Concert 2024 Details Â· Jay Chou Carnival World Tour 2024 â€“ Singapore Â· Date and time: 11 October 2024 (Friday) 20:00, 12-13 October 2024 ( ...&#39;, &quot;Jay Chou is playing in Shenzhencun on Sep 12, 2024, 7:00 PM at æ·±åœ³å¤§è¿ä¸­å¿ƒä½“è‚²åœº. Buy tickets, find concert information, and get ready for Jay Chou&#39;s show!&quot;, &#39;Concert tours ; 2019â€“2024, Carnival World Tour, October 17, 2019 â€“ present ; The Carnival World Tour commenced in October 2019, and was halted by the COVID-19 ...&#39;, &#39;Tickets for Jay Chou Carnival World Tour Australia 2024 â€“ Melbourne tickets will go on sale at 12pm on 26 October 2023, and Sydney tickets will go on sale at 2 ...&#39;, &#39;Jay Chou tickets for the upcoming concert tour are on sale at StubHub. Buy and sell your Jay Chou concert tickets today. Tickets are 100% guaranteed by ...&#39;, &quot;&#39;King of Mandopop&#39; Jay Chou first to give solo concert at Taipei Dome | Taiwan News | Sep. 7, 2024 19:40.&quot;][0m[32;1m[1;3mI found that Jay Chou has a concert scheduled for October 11, 2024, which is a Friday. </span>\n<span class="line"></span>\n<span class="line">Final Answer: Jay Chou&#39;s concert on October 11, 2024, is on a Friday.[0m</span>\n<span class="line"></span>\n<span class="line">[1m&gt; Finished chain.[0m</span>\n<span class="line">{&#39;input&#39;: &#39;2024å¹´å‘¨æ°ä¼¦çš„æ¼”å”±ä¼šæ˜ŸæœŸå‡ &#39;,</span>\n<span class="line"> &#39;output&#39;: &quot;Jay Chou&#39;s concert on October 11, 2024, is on a Friday.&quot;}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-æ™ºèƒ½ä½“ç±»å‹-selfaskwithsearch" tabindex="-1"><a class="header-anchor" href="#_5-4-æ™ºèƒ½ä½“ç±»å‹-selfaskwithsearch"><span>5.4 æ™ºèƒ½ä½“ç±»å‹ï¼šSelfAskWithSearch</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># ä¸‹è½½ä¸€ä¸ªæ¨¡æ¿</span></span>\n<span class="line">self_ask_prompt <span class="token operator">=</span> hub<span class="token punctuation">.</span>pull<span class="token punctuation">(</span><span class="token string">&quot;hwchase17/self-ask-with-search&quot;</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>self_ask_prompt<span class="token punctuation">.</span>template<span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">Question: Who lived longer, Muhammad Ali or Alan Turing?</span>\n<span class="line">Are follow up questions needed here: Yes.</span>\n<span class="line">Follow up: How old was Muhammad Ali when he died?</span>\n<span class="line">Intermediate answer: Muhammad Ali was 74 years old when he died.</span>\n<span class="line">Follow up: How old was Alan Turing when he died?</span>\n<span class="line">Intermediate answer: Alan Turing was 41 years old when he died.</span>\n<span class="line">So the final answer is: Muhammad Ali</span>\n<span class="line"></span>\n<span class="line">Question: When was the founder of craigslist born?</span>\n<span class="line">Are follow up questions needed here: Yes.</span>\n<span class="line">Follow up: Who was the founder of craigslist?</span>\n<span class="line">Intermediate answer: Craigslist was founded by Craig Newmark.</span>\n<span class="line">Follow up: When was Craig Newmark born?</span>\n<span class="line">Intermediate answer: Craig Newmark was born on December 6, 1952.</span>\n<span class="line">So the final answer is: December 6, 1952</span>\n<span class="line"></span>\n<span class="line">Question: Who was the maternal grandfather of George Washington?</span>\n<span class="line">Are follow up questions needed here: Yes.</span>\n<span class="line">Follow up: Who was the mother of George Washington?</span>\n<span class="line">Intermediate answer: The mother of George Washington was Mary Ball Washington.</span>\n<span class="line">Follow up: Who was the father of Mary Ball Washington?</span>\n<span class="line">Intermediate answer: The father of Mary Ball Washington was Joseph Ball.</span>\n<span class="line">So the final answer is: Joseph Ball</span>\n<span class="line"></span>\n<span class="line">Question: Are both the directors of Jaws and Casino Royale from the same country?</span>\n<span class="line">Are follow up questions needed here: Yes.</span>\n<span class="line">Follow up: Who is the director of Jaws?</span>\n<span class="line">Intermediate answer: The director of Jaws is Steven Spielberg.</span>\n<span class="line">Follow up: Where is Steven Spielberg from?</span>\n<span class="line">Intermediate answer: The United States.</span>\n<span class="line">Follow up: Who is the director of Casino Royale?</span>\n<span class="line">Intermediate answer: The director of Casino Royale is Martin Campbell.</span>\n<span class="line">Follow up: Where is Martin Campbell from?</span>\n<span class="line">Intermediate answer: New Zealand.</span>\n<span class="line">So the final answer is: No</span>\n<span class="line"></span>\n<span class="line">Question: {input}</span>\n<span class="line">Are followup questions needed here:{agent_scratchpad}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword">import</span> create_self_ask_with_search_agent</span>\n<span class="line"></span>\n<span class="line">tools <span class="token operator">=</span> <span class="token punctuation">[</span></span>\n<span class="line">    Tool<span class="token punctuation">(</span></span>\n<span class="line">        name<span class="token operator">=</span><span class="token string">&quot;Intermediate Answer&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">        func<span class="token operator">=</span>search<span class="token punctuation">.</span>run<span class="token punctuation">,</span></span>\n<span class="line">        description<span class="token operator">=</span><span class="token string">&quot;æœç´ å¼•æ“&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">        max_results<span class="token operator">=</span><span class="token number">1</span></span>\n<span class="line">    <span class="token punctuation">)</span></span>\n<span class="line"><span class="token punctuation">]</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># self_ask_with_search_agent åªèƒ½ä¼ ä¸€ä¸ªåä¸º &#39;Intermediate Answer&#39; çš„ tool</span></span>\n<span class="line">agent <span class="token operator">=</span> create_self_ask_with_search_agent<span class="token punctuation">(</span>llm<span class="token punctuation">,</span> tools<span class="token punctuation">,</span> self_ask_prompt<span class="token punctuation">)</span></span>\n<span class="line">agent_executor <span class="token operator">=</span> AgentExecutor<span class="token punctuation">(</span>agent<span class="token operator">=</span>agent<span class="token punctuation">,</span> tools<span class="token operator">=</span>tools<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> handle_parsing_errors<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">agent_executor<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;å†¯å°åˆšçš„è€å©†æ¼”è¿‡å“ªäº›ç”µå½±ï¼Œç”¨ä¸­æ–‡å›ç­”&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Output:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">[1m&gt; Entering new AgentExecutor chain...[0m</span>\n<span class="line">[32;1m[1;3mæ˜¯ã€‚</span>\n<span class="line">Follow up: å†¯å°åˆšçš„è€å©†æ˜¯è°ï¼Ÿ[0m[36;1m[1;3m[&#39;Feng Xiaogang is a Chinese film director, screenwriter, actor, producer and politician. He is well known in China as a highly successful commercial filmmaker whose comedy films do consistently well at the box office, although Feng has broken out from that mold by making some drama and period drama films.&#39;, &#39;Feng Xiaogang (å†¯å°åˆš) type: Chinese film director and screenwriter.&#39;, &#39;Feng Xiaogang (å†¯å°åˆš) entity_type: people.&#39;, &#39;Feng Xiaogang (å†¯å°åˆš) kgmid: /m/04xhrq.&#39;, &#39;Feng Xiaogang (å†¯å°åˆš) born: 1958 (age 66 years), Daxing District, Beijing, China.&#39;, &#39;Feng Xiaogang (å†¯å°åˆš) awards: Golden Horse Award for Best Leading Actor.&#39;, &#39;Feng Xiaogang (å†¯å°åˆš) children: Siyu Feng.&#39;, &#39;Feng Xiaogang (å†¯å°åˆš) height: 5â€² 10â€³.&#39;, &#39;å†¯å°åˆšå¦»å­å¾å¸†ï¼Œæ˜¯å†…åœ°çŸ¥åå¥³æ¼”å‘˜ï¼Œæ–‡è‰ºä¸–å®¶å‡ºèº«ï¼Œ1991å¹´ï¼Œ24å²çš„å¥¹æ¯•ä¸šäºå¤®æˆè¡¨æ¼”ä¸“ä¸šã€‚å½“æ—¶å¾å¸†åˆšå’Œç‹å¿—æ–‡åˆ†æ‰‹ï¼Œå¾ˆæ˜¯å¤±è½ï¼Œäºæ˜¯å†¯å°åˆšæ—¶å¸¸å®‰æ…°å’Œå¼€å¯¼å¥¹ï¼Œä¸¤äºº ...&#39;, &#39;å†¯å°åˆšè€å©†å¾å¸†å’Œå¥½å‹çƒ­èŠï¼Œå¿ƒæƒ…å¤§å¥½ï¼Œé¢å¸¦ç¬‘å®¹ï¼Œè¿˜å’Œæœ‹å‹ç›¸æ‹¥é€åˆ«ã€‚ä»å›¾ç‰‡çœ‹ï¼Œèº«æ—çš„å¥½å‹æ˜¯äºšæ´²é¢å­”ã€‚ ... 1999å¹´ï¼Œå†¯å°åˆšå’Œç¬¬ä¸€ä»»å¦»å­æ­£å¼ç¦»å©šï¼ŒåŒå¹´è¿å¨¶å¾å¸†ã€‚&#39;, &#39;å¾å¸†æ˜¯è‘—åå¯¼æ¼”å†¯å°åˆšçš„å¦»å­ï¼Œå¯ä»¥è¯´æ˜¯å®¶å–»æˆ·æ™“çš„å®åŠ›æ´¾å¥³æ˜Ÿã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚ä»Šå·²ç„¶äº”åäºŒå²çš„å¾å¸†çœ‹ä¸Šå»ä¾æ—§æ˜¯é“ä¸½åˆæ˜¾å¹´è½»ï¼Œæ•´ä¸ªäººæ²¡æœ‰åŠåˆ†è€æ€ï¼Œ ...&#39;, &#39;å°½ç®¡å†¯å°åˆšå’Œå¾å¸†å·²ç»ç»“å©šè¿™ä¹ˆå¤šå¹´ï¼Œä½†ä»–ä»¬ä¸¤ä¸ªäººå§‹ç»ˆæ²¡æœ‰å­©å­ã€‚ è€Œæ˜¯ä¸€ç›´ç…§é¡¾ç€å†¯å°åˆšå’Œå‰å¦»çš„å¥³å„¿å†¯æ€ç¾½ï¼Œæœ€åä¸¤ä¸ªäººä¹Ÿé¢†å…»äº†ä¸€ä¸ªå¥³å„¿ã€‚&#39;, &#39;å¾å¸†ï¼Œä½œä¸ºå†¯å°åˆšè€å©†ï¼Œè¿™ä¸ªå¥³äººç›¸è²Œç¾ä¸½ï¼Œå¿ƒæ€ä¹Ÿéå¸¸å¥½ï¼Œå¯¹å®¶åº­éå¸¸åŒ…å®¹ï¼Œ85åˆ†ã€‚å†¯å°åˆšè€å©†85åˆ†ï¼Œå¼ è‰ºè°‹è€å©†93åˆ†ï¼Œè€Œä»–çš„è€å©†æˆ‘æƒ³æ‰“666åˆ†.&#39;, &#39;å†¯å°åˆšå’Œå¾å¸†è‡ª1991å¹´å› ä¸ºã€Šå¤§æ’’æŠŠã€‹ç›¸è¯†ï¼Œ1999å¹´ç»“å©šï¼Œç›¸è¯†33å¹´ç»“å©š25å¹´ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰ç½‘å‹ä¸çœ‹å¥½ä»–ä»¬çš„å©šå§»å‘¢ï¼Ÿå…¶å®ç»†ç©¶ä»–ä»¬çš„å©šå§»å°±çŸ¥é“ï¼Œå¾å¸†èƒŒåçš„ä»˜å‡ºå¹¶ä¸ ...&#39;, &#39;å†¯å°åˆšä¸€å…±æœ‰å‡ ä¸ªå¦»å­. 2ä»»ã€‚å†¯å°åˆšä¸€å…±æœ‰2ä»»è€å©†2æ®µå©šå§»ï¼ŒåŸé…å¦»å­æ˜¯å¼ å¨£ã€‚å†¯å°åˆšï¼Œ1958å¹´3æœˆ18æ—¥å‡ºç”ŸäºåŒ—äº¬å¸‚å¤§å…´åŒºï¼Œç¥–ç±æ¹–å—çœæ¹˜æ½­å¸‚ï¼Œä¸­å›½å†…åœ°å¯¼æ¼”ã€ç¼–å‰§ã€æ¼”å‘˜ã€‚&#39;, &#39;1. å¾å¸†ï¼Œè‘—åå¯¼æ¼”å†¯å°åˆšçš„å¦»å­ï¼Œæ˜¯ä¸€ä½æ‰åæ¨ªæº¢çš„ä¸­å›½å¥³æ¼”å‘˜ã€‚2. å¥¹äº1967å¹´8æœˆ16æ—¥å‡ºç”Ÿäºæ¹–åŒ—çœæ­¦æ±‰å¸‚æ±Ÿæ±‰åŒºï¼Œ1991å¹´æ¯•ä¸šäºä¸­å¤®æˆå‰§å­¦é™¢è¡¨æ¼”ç³»ï¼Œå¹¶åŠ å…¥ ...&#39;, &#39;1999å¹´ï¼Œå¾å¸†å’Œå†¯å°åˆšå¦‚æ„¿ä»¥å¿é¢†è¯ç»“å©šï¼Œå©šåçš„é“è·¯ï¼Œå…¶å®è·Ÿå‰å¦»å¼ å¨£å¹¶æ— äºŒè‡´ã€‚ æ…¢æ…¢æˆä¸ºå¤§å¯¼æ¼”çš„å†¯å°åˆšï¼Œèº«è¾¹çš„èºèºç‡•ç‡• ...&#39;, &#39;å†¯å°åˆšçš„è€å©†æ˜¯å¾å¸†ã€‚ å¾å¸†1967å¹´8æœˆ16æ—¥å‡ºç”Ÿäºæ¹–åŒ—çœæ­¦æ±‰å¸‚æ±Ÿæ±‰åŒºï¼Œæ˜¯ä¸­å›½ç”µè§†ã€ç”µå½±æ¼”å‘˜ã€‚ å¥¹ä¸å†¯å°åˆšäº1999å¹´9æœˆ19æ—¥æ­£å¼ç»“å©šã€‚ åŸè‘—åŒæ ·ç²¾å½©ï¼Œå¯ä»¥ç‚¹å‡»ã€Šç«ç‘°çš„æ•…äº‹ã€‹ ...&#39;][0m[32;1m[1;3mCould not parse output: Intermediate answer: å†¯å°åˆšçš„è€å©†æ˜¯å¾å¸†ã€‚</span>\n<span class="line"></span>\n<span class="line">Follow up: å¾å¸†æ¼”è¿‡å“ªäº›ç”µå½±ï¼Ÿ</span>\n<span class="line">[0mInvalid or incomplete response[32;1m[1;3mIntermediate answer: å¾å¸†æ¼”è¿‡çš„ç”µå½±åŒ…æ‹¬ã€Šå”å±±å¤§åœ°éœ‡ã€‹ã€ã€Šæ‰‹æœºã€‹ã€ã€Šä¸€ä¹å››äºŒã€‹ã€ã€Šä¸è§ä¸æ•£ã€‹ç­‰ã€‚</span>\n<span class="line"></span>\n<span class="line">So the final answer is: å¾å¸†æ¼”è¿‡çš„ç”µå½±åŒ…æ‹¬ã€Šå”å±±å¤§åœ°éœ‡ã€‹ã€ã€Šæ‰‹æœºã€‹ã€ã€Šä¸€ä¹å››äºŒã€‹ã€ã€Šä¸è§ä¸æ•£ã€‹ç­‰ã€‚[0m</span>\n<span class="line"></span>\n<span class="line">[1m&gt; Finished chain.[0m</span>\n<span class="line">{&#39;input&#39;: &#39;å†¯å°åˆšçš„è€å©†æ¼”è¿‡å“ªäº›ç”µå½±ï¼Œç”¨ä¸­æ–‡å›ç­”&#39;,</span>\n<span class="line"> &#39;output&#39;: &#39;å¾å¸†æ¼”è¿‡çš„ç”µå½±åŒ…æ‹¬ã€Šå”å±±å¤§åœ°éœ‡ã€‹ã€ã€Šæ‰‹æœºã€‹ã€ã€Šä¸€ä¹å››äºŒã€‹ã€ã€Šä¸è§ä¸æ•£ã€‹ç­‰ã€‚&#39;}</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âœ… <strong>Tip:</strong> åˆ’é‡ç‚¹ï¼š Agentè½åœ°åº”ç”¨éœ€è¦æ›´å¤šç»†èŠ‚ï¼Œåé¢è¯¾ç¨‹ä¸­æˆ‘ä»¬ä¼šä¸“é—¨è®² Agent çš„å®ç°</p></blockquote><h2 id="å…­ã€langserve" tabindex="-1"><a class="header-anchor" href="#å…­ã€langserve"><span>å…­ã€LangServe</span></a></h2><p>LangServe ç”¨äºå°† Chain æˆ–è€… Runnable éƒ¨ç½²æˆä¸€ä¸ª REST API æœåŠ¡ã€‚</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># å®‰è£… LangServe</span></span>\n<span class="line"><span class="token comment"># !pip install --upgrade &quot;langserve[all]&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span class="token comment"># ä¹Ÿå¯ä»¥åªå®‰è£…ä¸€ç«¯</span></span>\n<span class="line"><span class="token comment"># !pip install &quot;langserve[client]&quot;</span></span>\n<span class="line"><span class="token comment"># !pip install &quot;langserve[server]&quot;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-1ã€server-ç«¯" tabindex="-1"><a class="header-anchor" href="#_6-1ã€server-ç«¯"><span>6.1ã€Server ç«¯</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>\n<span class="line"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI</span>\n<span class="line"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> ChatPromptTemplate</span>\n<span class="line"><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI</span>\n<span class="line"><span class="token keyword">from</span> langserve <span class="token keyword">import</span> add_routes</span>\n<span class="line"><span class="token keyword">import</span> uvicorn</span>\n<span class="line"></span>\n<span class="line">app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span></span>\n<span class="line">  title<span class="token operator">=</span><span class="token string">&quot;LangChain Server&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">  version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">  description<span class="token operator">=</span><span class="token string">&quot;A simple api server using Langchain&#39;s Runnable interfaces&quot;</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line">model <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="line">prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span><span class="token string">&quot;è®²ä¸€ä¸ªå…³äº{topic}çš„ç¬‘è¯&quot;</span><span class="token punctuation">)</span></span>\n<span class="line">add_routes<span class="token punctuation">(</span></span>\n<span class="line">    app<span class="token punctuation">,</span></span>\n<span class="line">    prompt <span class="token operator">|</span> model<span class="token punctuation">,</span></span>\n<span class="line">    path<span class="token operator">=</span><span class="token string">&quot;/joke&quot;</span><span class="token punctuation">,</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"></span>\n<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span></span>\n<span class="line">    uvicorn<span class="token punctuation">.</span>run<span class="token punctuation">(</span>app<span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2ã€client-ç«¯" tabindex="-1"><a class="header-anchor" href="#_6-2ã€client-ç«¯"><span>6.2ã€Client ç«¯</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> requests</span>\n<span class="line"></span>\n<span class="line">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span></span>\n<span class="line">    <span class="token string">&quot;http://localhost:9999/joke/invoke&quot;</span><span class="token punctuation">,</span></span>\n<span class="line">    json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;topic&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;å°æ˜&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n<span class="line"><span class="token punctuation">)</span></span>\n<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸ƒã€langchain-js" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€langchain-js"><span>ä¸ƒã€LangChain.js</span></a></h2><p>Python ç‰ˆ LangChain çš„å§Šå¦¹é¡¹ç›®ï¼Œéƒ½æ˜¯ç”± Harrison Chase ä¸»ç†ã€‚</p><p>é¡¹ç›®åœ°å€ï¼šhttps://github.com/langchain-ai/langchainjs</p><p>æ–‡æ¡£åœ°å€ï¼šhttps://js.langchain.com/docs/</p><p>ç‰¹è‰²ï¼š</p><ol><li><p>å¯ä»¥å’Œ Python ç‰ˆ LangChain æ— ç¼å¯¹æ¥</p></li><li><p>æŠ½è±¡è®¾è®¡å®Œå…¨ç›¸åŒï¼Œæ¦‚å¿µä¸€ä¸€å¯¹åº”</p></li><li><p>æ‰€æœ‰å¯¹è±¡åºåˆ—åŒ–åéƒ½èƒ½è·¨è¯­è¨€ä½¿ç”¨ï¼Œä½† API å·®åˆ«æŒºå¤§ï¼Œä¸è¿‡åœ¨åŠªåŠ›å¯¹é½</p></li></ol><p>æ”¯æŒç¯å¢ƒï¼š</p><ol><li>Node.js (ESM and CommonJS) - 18.x, 19.x, 20.x</li><li>Cloudflare Workers</li><li>Vercel / Next.js (Browser, Serverless and Edge functions)</li><li>Supabase Edge Functions</li><li>Browser</li><li>Deno</li></ol><p>å®‰è£…ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">npm install langchain</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“å‰é‡ç‚¹ï¼š</p><ol><li>è¿½ä¸Š Python ç‰ˆçš„èƒ½åŠ›ï¼ˆç”šè‡³ä¸ºæ­¤åšäº†ä¸€ä¸ªåŸºäº gpt-3.5-turbo çš„ä»£ç ç¿»è¯‘å™¨ï¼‰</li><li>ä¿æŒå…¼å®¹å°½å¯èƒ½å¤šçš„ç¯å¢ƒ</li><li>å¯¹è´¨é‡å…³æ³¨ä¸å¤šï¼Œéšæ—¶é—´è‡ªç„¶èƒ½è§£å†³</li></ol><h3 id="langchain-ä¸-llamaindex-çš„é”™ä½ç«äº‰" tabindex="-1"><a class="header-anchor" href="#langchain-ä¸-llamaindex-çš„é”™ä½ç«äº‰"><span>LangChain ä¸ LlamaIndex çš„é”™ä½ç«äº‰</span></a></h3><ul><li>LangChain ä¾§é‡ä¸ LLM æœ¬èº«äº¤äº’çš„å°è£… <ul><li>Promptã€LLMã€Messageã€OutputParser ç­‰å·¥å…·ä¸°å¯Œ</li><li>åœ¨æ•°æ®å¤„ç†å’Œ RAG æ–¹é¢æä¾›çš„å·¥å…·ç›¸å¯¹ç²—ç³™</li><li>ä¸»æ‰“ LCEL æµç¨‹å°è£…</li><li>é…å¥— Agentã€LangGraph ç­‰æ™ºèƒ½ä½“ä¸å·¥ä½œæµå·¥å…·</li><li>å¦æœ‰ LangServe éƒ¨ç½²å·¥å…·å’Œ LangSmith ç›‘æ§è°ƒè¯•å·¥å…·</li></ul></li><li>LlamaIndex ä¾§é‡ä¸æ•°æ®äº¤äº’çš„å°è£… <ul><li>æ•°æ®åŠ è½½ã€åˆ‡å‰²ã€ç´¢å¼•ã€æ£€ç´¢ã€æ’åºç­‰ç›¸å…³å·¥å…·ä¸°å¯Œ</li><li>Promptã€LLM ç­‰åº•å±‚å°è£…ç›¸å¯¹å•è–„</li><li>é…å¥—å®ç° RAG ç›¸å…³å·¥å…·</li><li>æœ‰ Agent ç›¸å…³å·¥å…·ï¼Œä¸çªå‡º</li></ul></li><li>LlamaIndex ä¸º LangChain æä¾›äº†é›†æˆ <ul><li>åœ¨ LlamaIndex ä¸­è°ƒç”¨ LangChain å°è£…çš„ LLM æ¥å£ï¼šhttps://docs.llamaindex.ai/en/stable/api_reference/llms/langchain/</li><li>å°† LlamaIndex çš„ Query Engine ä½œä¸º LangChain Agent çš„å·¥å…·ï¼šhttps://docs.llamaindex.ai/en/v0.10.17/community/integrations/using_with_langchain.html</li><li>LangChain ä¹Ÿ <em>æ›¾ç»</em> é›†æˆè¿‡ LlamaIndexï¼Œç›®å‰ç›¸å…³æ¥å£ä»åœ¨ï¼šhttps://api.python.langchain.com/en/latest/retrievers/langchain_community.retrievers.llama_index.LlamaIndexRetriever.html</li></ul></li></ul><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><ol><li>LangChain éšç€ç‰ˆæœ¬è¿­ä»£å¯ç”¨æ€§æœ‰æ˜æ˜¾æå‡</li><li>ä½¿ç”¨ LangChain è¦æ³¨æ„ç»´æŠ¤è‡ªå·±çš„ Promptï¼Œå°½é‡ Prompt ä¸ä»£ç é€»è¾‘è§£ä¾èµ–</li><li>å®ƒçš„å†…ç½®åŸºç¡€å·¥å…·ï¼Œå»ºè®®å……åˆ†æµ‹è¯•æ•ˆæœåå†å†³å®šæ˜¯å¦ä½¿ç”¨</li></ol>',224)])])}]]),r=JSON.parse('{"path":"/tutorial/llm/08-langchain.html","title":"08 Langchain   Index","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"ğŸ’¡ è¿™èŠ‚è¯¾ä¼šå¸¦ç»™ä½ ","slug":"ğŸ’¡-è¿™èŠ‚è¯¾ä¼šå¸¦ç»™ä½ ","link":"#ğŸ’¡-è¿™èŠ‚è¯¾ä¼šå¸¦ç»™ä½ ","children":[]},{"level":2,"title":"ğŸ“ è¿™èŠ‚è¯¾æ€ä¹ˆå­¦","slug":"ğŸ“-è¿™èŠ‚è¯¾æ€ä¹ˆå­¦","link":"#ğŸ“-è¿™èŠ‚è¯¾æ€ä¹ˆå­¦","children":[]},{"level":2,"title":"å†™åœ¨å‰é¢","slug":"å†™åœ¨å‰é¢","link":"#å†™åœ¨å‰é¢","children":[]},{"level":2,"title":"LangChain çš„æ ¸å¿ƒç»„ä»¶","slug":"langchain-çš„æ ¸å¿ƒç»„ä»¶","link":"#langchain-çš„æ ¸å¿ƒç»„ä»¶","children":[{"level":3,"title":"æ–‡æ¡£ï¼ˆä»¥ Python ç‰ˆä¸ºä¾‹ï¼‰","slug":"æ–‡æ¡£-ä»¥-python-ç‰ˆä¸ºä¾‹","link":"#æ–‡æ¡£-ä»¥-python-ç‰ˆä¸ºä¾‹","children":[]}]},{"level":2,"title":"ä¸€ã€æ¨¡å‹ I/O å°è£…","slug":"ä¸€ã€æ¨¡å‹-i-o-å°è£…","link":"#ä¸€ã€æ¨¡å‹-i-o-å°è£…","children":[{"level":3,"title":"1.1 æ¨¡å‹ APIï¼šLLM vs. ChatModel","slug":"_1-1-æ¨¡å‹-api-llm-vs-chatmodel","link":"#_1-1-æ¨¡å‹-api-llm-vs-chatmodel","children":[]},{"level":3,"title":"1.1.1 OpenAI æ¨¡å‹å°è£…","slug":"_1-1-1-openai-æ¨¡å‹å°è£…","link":"#_1-1-1-openai-æ¨¡å‹å°è£…","children":[]},{"level":3,"title":"1.1.2 å¤šè½®å¯¹è¯ Session å°è£…","slug":"_1-1-2-å¤šè½®å¯¹è¯-session-å°è£…","link":"#_1-1-2-å¤šè½®å¯¹è¯-session-å°è£…","children":[]},{"level":3,"title":"1.1.3 æ¢ä¸ªå›½äº§æ¨¡å‹","slug":"_1-1-3-æ¢ä¸ªå›½äº§æ¨¡å‹","link":"#_1-1-3-æ¢ä¸ªå›½äº§æ¨¡å‹","children":[]},{"level":3,"title":"1.2 æ¨¡å‹çš„è¾“å…¥ä¸è¾“å‡º","slug":"_1-2-æ¨¡å‹çš„è¾“å…¥ä¸è¾“å‡º","link":"#_1-2-æ¨¡å‹çš„è¾“å…¥ä¸è¾“å‡º","children":[]},{"level":3,"title":"1.2.1 Prompt æ¨¡æ¿å°è£…","slug":"_1-2-1-prompt-æ¨¡æ¿å°è£…","link":"#_1-2-1-prompt-æ¨¡æ¿å°è£…","children":[]},{"level":3,"title":"1.2.2ã€ä»æ–‡ä»¶åŠ è½½ Prompt æ¨¡æ¿","slug":"_1-2-2ã€ä»æ–‡ä»¶åŠ è½½-prompt-æ¨¡æ¿","link":"#_1-2-2ã€ä»æ–‡ä»¶åŠ è½½-prompt-æ¨¡æ¿","children":[]},{"level":3,"title":"1.3 ç»“æ„åŒ–è¾“å‡º","slug":"_1-3-ç»“æ„åŒ–è¾“å‡º","link":"#_1-3-ç»“æ„åŒ–è¾“å‡º","children":[]},{"level":3,"title":"1.3.1 ç›´æ¥è¾“å‡º Pydantic å¯¹è±¡","slug":"_1-3-1-ç›´æ¥è¾“å‡º-pydantic-å¯¹è±¡","link":"#_1-3-1-ç›´æ¥è¾“å‡º-pydantic-å¯¹è±¡","children":[]},{"level":3,"title":"1.3.2 è¾“å‡ºæŒ‡å®šæ ¼å¼çš„ JSON","slug":"_1-3-2-è¾“å‡ºæŒ‡å®šæ ¼å¼çš„-json","link":"#_1-3-2-è¾“å‡ºæŒ‡å®šæ ¼å¼çš„-json","children":[]},{"level":3,"title":"1.3.3 ä½¿ç”¨ OutputParser","slug":"_1-3-3-ä½¿ç”¨-outputparser","link":"#_1-3-3-ä½¿ç”¨-outputparser","children":[]},{"level":3,"title":"1.5ã€å°ç»“","slug":"_1-5ã€å°ç»“","link":"#_1-5ã€å°ç»“","children":[]}]},{"level":2,"title":"äºŒã€æ•°æ®è¿æ¥å°è£…","slug":"äºŒã€æ•°æ®è¿æ¥å°è£…","link":"#äºŒã€æ•°æ®è¿æ¥å°è£…","children":[{"level":3,"title":"2.1 æ–‡æ¡£åŠ è½½å™¨ï¼šDocument Loaders","slug":"_2-1-æ–‡æ¡£åŠ è½½å™¨-document-loaders","link":"#_2-1-æ–‡æ¡£åŠ è½½å™¨-document-loaders","children":[]},{"level":3,"title":"2.2 æ–‡æ¡£å¤„ç†å™¨","slug":"_2-2-æ–‡æ¡£å¤„ç†å™¨","link":"#_2-2-æ–‡æ¡£å¤„ç†å™¨","children":[]},{"level":3,"title":"2.2.1 TextSplitter","slug":"_2-2-1-textsplitter","link":"#_2-2-1-textsplitter","children":[]},{"level":3,"title":"2.3ã€å‘é‡æ•°æ®åº“ä¸å‘é‡æ£€ç´¢","slug":"_2-3ã€å‘é‡æ•°æ®åº“ä¸å‘é‡æ£€ç´¢","link":"#_2-3ã€å‘é‡æ•°æ®åº“ä¸å‘é‡æ£€ç´¢","children":[]},{"level":3,"title":"2.4ã€å°ç»“","slug":"_2-4ã€å°ç»“","link":"#_2-4ã€å°ç»“","children":[]}]},{"level":2,"title":"ä¸‰ã€å¯¹è¯å†å²ç®¡ç†","slug":"ä¸‰ã€å¯¹è¯å†å²ç®¡ç†","link":"#ä¸‰ã€å¯¹è¯å†å²ç®¡ç†","children":[{"level":3,"title":"3.1ã€å†å²è®°å½•çš„å‰ªè£","slug":"_3-1ã€å†å²è®°å½•çš„å‰ªè£","link":"#_3-1ã€å†å²è®°å½•çš„å‰ªè£","children":[]},{"level":3,"title":"3.2ã€è¿‡æ»¤å¸¦æ ‡è¯†çš„å†å²è®°å½•","slug":"_3-2ã€è¿‡æ»¤å¸¦æ ‡è¯†çš„å†å²è®°å½•","link":"#_3-2ã€è¿‡æ»¤å¸¦æ ‡è¯†çš„å†å²è®°å½•","children":[]}]},{"level":2,"title":"å››ã€Chain å’Œ LangChain Expression Language (LCEL)","slug":"å››ã€chain-å’Œ-langchain-expression-language-lcel","link":"#å››ã€chain-å’Œ-langchain-expression-language-lcel","children":[{"level":3,"title":"4.1 Pipeline å¼è°ƒç”¨ PromptTemplate, LLM å’Œ OutputParser","slug":"_4-1-pipeline-å¼è°ƒç”¨-prompttemplate-llm-å’Œ-outputparser","link":"#_4-1-pipeline-å¼è°ƒç”¨-prompttemplate-llm-å’Œ-outputparser","children":[]},{"level":3,"title":"4.2 ç”¨ LCEL å®ç° RAG","slug":"_4-2-ç”¨-lcel-å®ç°-rag","link":"#_4-2-ç”¨-lcel-å®ç°-rag","children":[]},{"level":3,"title":"4.3 ç”¨ LCEL å®ç°å·¥å‚æ¨¡å¼ï¼ˆé€‰ï¼‰","slug":"_4-3-ç”¨-lcel-å®ç°å·¥å‚æ¨¡å¼-é€‰","link":"#_4-3-ç”¨-lcel-å®ç°å·¥å‚æ¨¡å¼-é€‰","children":[]},{"level":3,"title":"4.4 å­˜å‚¨ä¸ç®¡ç†å¯¹è¯å†å²","slug":"_4-4-å­˜å‚¨ä¸ç®¡ç†å¯¹è¯å†å²","link":"#_4-4-å­˜å‚¨ä¸ç®¡ç†å¯¹è¯å†å²","children":[]},{"level":3,"title":"é€šè¿‡ LCELï¼Œè¿˜å¯ä»¥å®ç°","slug":"é€šè¿‡-lcel-è¿˜å¯ä»¥å®ç°","link":"#é€šè¿‡-lcel-è¿˜å¯ä»¥å®ç°","children":[]}]},{"level":2,"title":"äº”ã€æ™ºèƒ½ä½“æ¶æ„ï¼šAgent","slug":"äº”ã€æ™ºèƒ½ä½“æ¶æ„-agent","link":"#äº”ã€æ™ºèƒ½ä½“æ¶æ„-agent","children":[{"level":3,"title":"5.1 ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“ï¼ˆAgentï¼‰","slug":"_5-1-ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“-agent","link":"#_5-1-ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“-agent","children":[]},{"level":3,"title":"5.2 å…ˆå®šä¹‰ä¸€äº›å·¥å…·ï¼šTools","slug":"_5-2-å…ˆå®šä¹‰ä¸€äº›å·¥å…·-tools","link":"#_5-2-å…ˆå®šä¹‰ä¸€äº›å·¥å…·-tools","children":[]},{"level":3,"title":"5.3 æ™ºèƒ½ä½“ç±»å‹ï¼šReAct","slug":"_5-3-æ™ºèƒ½ä½“ç±»å‹-react","link":"#_5-3-æ™ºèƒ½ä½“ç±»å‹-react","children":[]},{"level":3,"title":"5.4 æ™ºèƒ½ä½“ç±»å‹ï¼šSelfAskWithSearch","slug":"_5-4-æ™ºèƒ½ä½“ç±»å‹-selfaskwithsearch","link":"#_5-4-æ™ºèƒ½ä½“ç±»å‹-selfaskwithsearch","children":[]}]},{"level":2,"title":"å…­ã€LangServe","slug":"å…­ã€langserve","link":"#å…­ã€langserve","children":[{"level":3,"title":"6.1ã€Server ç«¯","slug":"_6-1ã€server-ç«¯","link":"#_6-1ã€server-ç«¯","children":[]},{"level":3,"title":"6.2ã€Client ç«¯","slug":"_6-2ã€client-ç«¯","link":"#_6-2ã€client-ç«¯","children":[]}]},{"level":2,"title":"ä¸ƒã€LangChain.js","slug":"ä¸ƒã€langchain-js","link":"#ä¸ƒã€langchain-js","children":[{"level":3,"title":"LangChain ä¸ LlamaIndex çš„é”™ä½ç«äº‰","slug":"langchain-ä¸-llamaindex-çš„é”™ä½ç«äº‰","link":"#langchain-ä¸-llamaindex-çš„é”™ä½ç«äº‰","children":[]}]},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“","link":"#æ€»ç»“","children":[]}],"git":{"contributors":[{"name":"mingwzh","username":"mingwzh","email":"1127699551@qq.com","commits":1,"url":"https://github.com/mingwzh"}],"changelog":[{"hash":"05a88520927ee36167bfac2292942e67dac7c994","time":1768639986000,"email":"1127699551@qq.com","author":"mingwzh","message":"docs(langchain): æ·»åŠ  LangChain æ•™ç¨‹ 08 ç« å®Œæ•´æ–‡æ¡£"}]},"filePathRelative":"tutorial/llm/08-langchain.md"}')}}]);