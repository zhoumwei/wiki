<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>嵌入式学习教程 | 知识库</title><meta name="description" content="涵盖Java、Spring、Vue、Node.js等技术知识">
    <link rel="stylesheet" href="/wiki/assets/css/styles.2a121ef9.css">
    <link rel="preload" href="/wiki/assets/js/runtime~app.e5a338d5.js" as="script"><link rel="preload" href="/wiki/assets/css/styles.2a121ef9.css" as="style"><link rel="preload" href="/wiki/assets/js/768.e6d4205d.js" as="script"><link rel="preload" href="/wiki/assets/js/app.afddf092.js" as="script">
    <link rel="prefetch" href="/wiki/assets/js/solution_smart-marketing_index.html.c6a04243.js" as="script"><link rel="prefetch" href="/wiki/assets/js/solution_high-availability_index.html.1ef390b5.js" as="script"><link rel="prefetch" href="/wiki/assets/js/tutorial_react_index.html.4aacb360.js" as="script"><link rel="prefetch" href="/wiki/assets/js/solution_aiops_index.html.9565eae6.js" as="script"><link rel="prefetch" href="/wiki/assets/js/tutorial_swift_index.html.26390310.js" as="script"><link rel="prefetch" href="/wiki/assets/js/tutorial_embedded_index.html.1d42b838.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_nodejs_index.html.42d74f45.js" as="script"><link rel="prefetch" href="/wiki/assets/js/tutorial_python_index.html.e9a522b3.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_spring-boot_index.html.38761574.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_java_jdk-changes_index.html.25824bdf.js" as="script"><link rel="prefetch" href="/wiki/assets/js/tutorial_r_index.html.16153cc5.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_vue_index.html.63167ab5.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_java_concurrency_index.html.e362b849.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_java_advanced_index.html.71c33c5c.js" as="script"><link rel="prefetch" href="/wiki/assets/js/solution_finops_tools.html.89ed1e0f.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_spring-cloud_index.html.fd0f185e.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_message-queue_index.html.b4b3c3e6.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_big-data_index.html.bbd64ec0.js" as="script"><link rel="prefetch" href="/wiki/assets/js/tutorial_llm_index.html.09e48380.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_database_index.html.14a46108.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_java_basic_index.html.bddf19ef.js" as="script"><link rel="prefetch" href="/wiki/assets/js/tutorial_ml_index.html.7188e38d.js" as="script"><link rel="prefetch" href="/wiki/assets/js/interview_java_collections_index.html.0c5ba651.js" as="script"><link rel="prefetch" href="/wiki/assets/js/tutorial_rl_index.html.6c114c3c.js" as="script"><link rel="prefetch" href="/wiki/assets/js/solution_finops_implementation.html.5e17714b.js" as="script"><link rel="prefetch" href="/wiki/assets/js/get-started.html.c4557635.js" as="script"><link rel="prefetch" href="/wiki/assets/js/solution_finops_risk-trends.html.6525c9fc.js" as="script"><link rel="prefetch" href="/wiki/assets/js/solution_finops_case-studies.html.08c4404f.js" as="script"><link rel="prefetch" href="/wiki/assets/js/index.html.6a2169db.js" as="script"><link rel="prefetch" href="/wiki/assets/js/solution_finops_index.html.726a0ab3.js" as="script"><link rel="prefetch" href="/wiki/assets/js/solution_finops_concept.html.0854ee3f.js" as="script"><link rel="prefetch" href="/wiki/assets/js/404.html.a5b4614e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/wiki/"><img class="vp-site-logo" src="/wiki/logo/logo.svg" alt="知识库"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">知识库</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/wiki/" aria-label="首页"><!--[--><!--[--><!--]--><!--]-->首页<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/wiki/get-started.html" aria-label="开始阅读"><!--[--><!--[--><!--]--><!--]-->开始阅读<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/basic/" aria-label="Java基础"><!--[--><!--[--><!--]--><!--]-->Java基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/advanced/" aria-label="Java高级"><!--[--><!--[--><!--]--><!--]-->Java高级<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/collections/" aria-label="Java集合详解"><!--[--><!--[--><!--]--><!--]-->Java集合详解<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/concurrency/" aria-label="Java多线程详解"><!--[--><!--[--><!--]--><!--]-->Java多线程详解<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/jdk-changes/" aria-label="JDK版本变化详解"><!--[--><!--[--><!--]--><!--]-->JDK版本变化详解<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Spring"><span class="title">Spring</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Spring"><span class="title">Spring</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/spring-boot/" aria-label="Spring Boot"><!--[--><!--[--><!--]--><!--]-->Spring Boot<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/spring-cloud/" aria-label="Spring Cloud"><!--[--><!--[--><!--]--><!--]-->Spring Cloud<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="解决方案"><span class="title">解决方案</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="解决方案"><span class="title">解决方案</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/solution/aiops/" aria-label="AIOps"><!--[--><!--[--><!--]--><!--]-->AIOps<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/solution/finops/" aria-label="FinOps"><!--[--><!--[--><!--]--><!--]-->FinOps<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/solution/high-availability/" aria-label="高可用架构"><!--[--><!--[--><!--]--><!--]-->高可用架构<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/solution/smart-marketing/" aria-label="智能营销"><!--[--><!--[--><!--]--><!--]-->智能营销<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/wiki/" aria-label="首页"><!--[--><!--[--><!--]--><!--]-->首页<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/wiki/get-started.html" aria-label="开始阅读"><!--[--><!--[--><!--]--><!--]-->开始阅读<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/basic/" aria-label="Java基础"><!--[--><!--[--><!--]--><!--]-->Java基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/advanced/" aria-label="Java高级"><!--[--><!--[--><!--]--><!--]-->Java高级<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/collections/" aria-label="Java集合详解"><!--[--><!--[--><!--]--><!--]-->Java集合详解<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/concurrency/" aria-label="Java多线程详解"><!--[--><!--[--><!--]--><!--]-->Java多线程详解<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/java/jdk-changes/" aria-label="JDK版本变化详解"><!--[--><!--[--><!--]--><!--]-->JDK版本变化详解<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Spring"><span class="title">Spring</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Spring"><span class="title">Spring</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/spring-boot/" aria-label="Spring Boot"><!--[--><!--[--><!--]--><!--]-->Spring Boot<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/interview/spring-cloud/" aria-label="Spring Cloud"><!--[--><!--[--><!--]--><!--]-->Spring Cloud<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="解决方案"><span class="title">解决方案</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="解决方案"><span class="title">解决方案</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/solution/aiops/" aria-label="AIOps"><!--[--><!--[--><!--]--><!--]-->AIOps<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/solution/finops/" aria-label="FinOps"><!--[--><!--[--><!--]--><!--]-->FinOps<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/solution/high-availability/" aria-label="高可用架构"><!--[--><!--[--><!--]--><!--]-->高可用架构<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/wiki/solution/smart-marketing/" aria-label="智能营销"><!--[--><!--[--><!--]--><!--]-->智能营销<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/wiki/tutorial/embedded/" aria-label="嵌入式教程"><!--[--><!--[--><!--]--><!--]-->嵌入式教程<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="嵌入式学习教程" tabindex="-1"><a class="header-anchor" href="#嵌入式学习教程"><span>嵌入式学习教程</span></a></h1><h2 id="_1-嵌入式系统基础" tabindex="-1"><a class="header-anchor" href="#_1-嵌入式系统基础"><span>1. 嵌入式系统基础</span></a></h2><h3 id="q1-什么是嵌入式系统-它有什么特点" tabindex="-1"><a class="header-anchor" href="#q1-什么是嵌入式系统-它有什么特点"><span>Q1: 什么是嵌入式系统？它有什么特点？</span></a></h3><p><strong>答：</strong> 嵌入式系统是以应用为中心，以计算机技术为基础，软硬件可裁剪，适用于对功能、可靠性、成本、体积、功耗有严格要求的专用计算机系统。</p><p>主要特点：</p><ul><li><strong>专用性</strong>：针对特定应用设计</li><li><strong>实时性</strong>：对外部事件快速响应</li><li><strong>可靠性</strong>：长时间稳定运行</li><li><strong>资源受限</strong>：内存、存储、处理能力有限</li><li><strong>功耗要求</strong>：通常要求低功耗运行</li><li><strong>成本敏感</strong>：需要控制硬件成本</li><li><strong>生命周期长</strong>：产品更新换代较慢</li></ul><h3 id="q2-嵌入式系统的组成结构" tabindex="-1"><a class="header-anchor" href="#q2-嵌入式系统的组成结构"><span>Q2: 嵌入式系统的组成结构？</span></a></h3><p><strong>答：</strong> 嵌入式系统主要由以下几个部分组成：</p><ol><li><p><strong>硬件层</strong>：</p><ul><li>处理器（CPU）：ARM、MIPS、PowerPC等</li><li>存储器：RAM、ROM/Flash</li><li>输入/输出接口：GPIO、UART、SPI、I2C等</li><li>时钟电路、复位电路等外围电路</li></ul></li><li><p><strong>实时操作系统层</strong>（RTOS）：</p><ul><li>任务调度</li><li>内存管理</li><li>设备驱动</li><li>文件系统</li></ul></li><li><p><strong>应用软件层</strong>：</p><ul><li>用户应用程序</li><li>中间件</li><li>协议栈</li></ul></li><li><p><strong>开发工具层</strong>：</p><ul><li>编译器</li><li>调试器</li><li>仿真器</li></ul></li></ol><h3 id="q3-嵌入式处理器架构有哪些" tabindex="-1"><a class="header-anchor" href="#q3-嵌入式处理器架构有哪些"><span>Q3: 嵌入式处理器架构有哪些？</span></a></h3><p><strong>答：</strong> 常见的嵌入式处理器架构包括：</p><ol><li><p><strong>ARM架构</strong>：</p><ul><li>ARM Cortex-M系列：微控制器，低功耗</li><li>ARM Cortex-A系列：应用处理器，高性能</li><li>ARM Cortex-R系列：实时处理器</li></ul></li><li><p><strong>MIPS架构</strong>：</p><ul><li>广泛用于网络设备和路由器</li></ul></li><li><p><strong>PowerPC架构</strong>：</p><ul><li>主要用于汽车电子和工业控制</li></ul></li><li><p><strong>RISC-V架构</strong>：</p><ul><li>开源指令集架构，新兴选择</li></ul></li><li><p><strong>DSP处理器</strong>：</p><ul><li>专门用于数字信号处理</li><li>TI C2000、C5000、C6000系列</li></ul></li></ol><h2 id="_2-嵌入式开发环境" tabindex="-1"><a class="header-anchor" href="#_2-嵌入式开发环境"><span>2. 嵌入式开发环境</span></a></h2><h3 id="q4-嵌入式开发需要哪些工具" tabindex="-1"><a class="header-anchor" href="#q4-嵌入式开发需要哪些工具"><span>Q4: 嵌入式开发需要哪些工具？</span></a></h3><p><strong>答：</strong> 嵌入式开发需要以下工具链：</p><p><strong>开发环境</strong>：</p><ol><li><p><strong>集成开发环境</strong>（IDE）：</p><ul><li>Keil MDK（ARM开发）</li><li>IAR Embedded Workbench</li><li>STM32CubeIDE</li><li>Eclipse with plugins</li></ul></li><li><p><strong>编译器</strong>：</p><ul><li>GCC（GNU Compiler Collection）</li><li>ARM Compiler</li><li>IAR Compiler</li></ul></li><li><p><strong>调试工具</strong>：</p><ul><li>JTAG/SWD调试器</li><li>逻辑分析仪</li><li>示波器</li></ul></li></ol><p><strong>硬件工具</strong>：</p><ol><li><p><strong>开发板</strong>：</p><ul><li>Arduino系列</li><li>STM32系列</li><li>Raspberry Pi</li><li>ESP32/ESP8266</li></ul></li><li><p><strong>编程器/调试器</strong>：</p><ul><li>J-Link</li><li>ST-Link</li><li>CMSIS-DAP</li></ul></li></ol><h3 id="q5-嵌入式c语言编程特点" tabindex="-1"><a class="header-anchor" href="#q5-嵌入式c语言编程特点"><span>Q5: 嵌入式C语言编程特点？</span></a></h3><p><strong>答：</strong> 嵌入式C语言编程有以下特点：</p><p><strong>内存管理</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 避免动态内存分配</span></span>
<span class="line"><span class="token comment">// 不推荐</span></span>
<span class="line"><span class="token keyword">char</span> <span class="token operator">*</span>buffer <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 推荐</span></span>
<span class="line"><span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用静态变量减少栈使用</span></span>
<span class="line"><span class="token keyword">static</span> <span class="token class-name">uint32_t</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>位操作</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 位操作常用技巧</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BIT0</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BIT1</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 设置位</span></span>
<span class="line">REG <span class="token operator">|=</span> BIT0<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 清除位</span></span>
<span class="line">REG <span class="token operator">&amp;=</span> <span class="token operator">~</span>BIT1<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 检查位</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>REG <span class="token operator">&amp;</span> BIT0<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 位0被设置</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>寄存器操作</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 定义寄存器地址</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOA_BASE</span>    <span class="token expression"><span class="token number">0x40020000</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOA_MODER</span>   <span class="token expression"><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token class-name">uint32_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>GPIOA_BASE <span class="token operator">+</span> <span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOA_ODR</span>     <span class="token expression"><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token class-name">uint32_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>GPIOA_BASE <span class="token operator">+</span> <span class="token number">0x14</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 配置GPIO</span></span>
<span class="line">GPIOA_MODER <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置PA5为输出</span></span>
<span class="line">GPIOA_ODR <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 设置PA5高电平</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>中断处理</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 中断服务程序</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">USART1_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 清除中断标志</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>USART1<span class="token operator">-&gt;</span>SR <span class="token operator">&amp;</span> USART_SR_RXNE<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">uint8_t</span> data <span class="token operator">=</span> USART1<span class="token operator">-&gt;</span>DR<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 处理接收数据</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q6-嵌入式系统启动流程" tabindex="-1"><a class="header-anchor" href="#q6-嵌入式系统启动流程"><span>Q6: 嵌入式系统启动流程？</span></a></h3><p><strong>答：</strong> 嵌入式系统的启动流程通常包括以下几个阶段：</p><ol><li><p><strong>复位阶段</strong>：</p><ul><li>系统上电或复位</li><li>CPU从复位向量开始执行</li><li>初始化堆栈指针</li></ul></li><li><p><strong>启动代码执行</strong>：</p><ul><li>初始化时钟系统</li><li>初始化存储器控制器</li><li>初始化堆栈</li><li>复制初始化数据段</li></ul></li><li><p><strong>C运行时环境初始化</strong>：</p><ul><li>初始化全局变量和静态变量</li><li>调用构造函数（C++）</li></ul></li><li><p><strong>main函数执行</strong>：</p><ul><li>应用程序入口点</li><li>初始化外设</li><li>进入主循环</li></ul></li></ol><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 典型的启动代码结构</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">Reset_Handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 初始化堆栈指针</span></span>
<span class="line">    <span class="token function">__set_MSP</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>_estack<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 初始化数据段</span></span>
<span class="line">    <span class="token class-name">uint32_t</span> <span class="token operator">*</span>pSrc <span class="token operator">=</span> <span class="token operator">&amp;</span>_etext<span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">uint32_t</span> <span class="token operator">*</span>pDest <span class="token operator">=</span> <span class="token operator">&amp;</span>_sdata<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span>pDest <span class="token operator">&lt;</span> <span class="token operator">&amp;</span>_edata<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">*</span>pDest<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>pSrc<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 清零bss段</span></span>
<span class="line">    pDest <span class="token operator">=</span> <span class="token operator">&amp;</span>_sbss<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span>pDest <span class="token operator">&lt;</span> <span class="token operator">&amp;</span>_ebss<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">*</span>pDest<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 调用main函数</span></span>
<span class="line">    <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 正常不会执行到这里</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-实时操作系统-rtos" tabindex="-1"><a class="header-anchor" href="#_3-实时操作系统-rtos"><span>3. 实时操作系统（RTOS）</span></a></h2><h3 id="q7-什么是rtos-常用的rtos有哪些" tabindex="-1"><a class="header-anchor" href="#q7-什么是rtos-常用的rtos有哪些"><span>Q7: 什么是RTOS？常用的RTOS有哪些？</span></a></h3><p><strong>答：</strong> RTOS（Real-Time Operating System）是专门为实时应用设计的操作系统，能够在严格的时间约束内响应外部事件。</p><p><strong>主要特征</strong>：</p><ul><li><strong>任务调度</strong>：基于优先级的抢占式调度</li><li><strong>中断管理</strong>：快速响应外部中断</li><li><strong>同步机制</strong>：信号量、互斥量、消息队列等</li><li><strong>内存管理</strong>：静态内存分配为主</li><li><strong>定时器管理</strong>：软件定时器支持</li></ul><p><strong>常用RTOS</strong>：</p><ol><li><strong>FreeRTOS</strong>：开源、轻量级、广泛应用</li><li><strong>uC/OS-II/III</strong>：商业RTOS，稳定性好</li><li><strong>RT-Thread</strong>：国产开源RTOS</li><li><strong>Zephyr</strong>：Linux基金会项目</li><li><strong>VxWorks</strong>：商业实时操作系统</li></ol><h3 id="q8-freertos任务管理" tabindex="-1"><a class="header-anchor" href="#q8-freertos任务管理"><span>Q8: FreeRTOS任务管理？</span></a></h3><p><strong>答：</strong> FreeRTOS的任务管理机制：</p><p><strong>任务创建</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 任务函数原型</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">vTaskFunction</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>pvParameters<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 创建任务</span></span>
<span class="line">TaskHandle_t xHandle<span class="token punctuation">;</span></span>
<span class="line">BaseType_t xReturned <span class="token operator">=</span> <span class="token function">xTaskCreate</span><span class="token punctuation">(</span></span>
<span class="line">    vTaskFunction<span class="token punctuation">,</span>      <span class="token comment">// 任务函数</span></span>
<span class="line">    <span class="token string">&quot;TASK_NAME&quot;</span><span class="token punctuation">,</span>        <span class="token comment">// 任务名称</span></span>
<span class="line">    <span class="token number">128</span><span class="token punctuation">,</span>               <span class="token comment">// 栈大小（字）</span></span>
<span class="line">    <span class="token constant">NULL</span><span class="token punctuation">,</span>              <span class="token comment">// 参数</span></span>
<span class="line">    <span class="token number">1</span><span class="token punctuation">,</span>                 <span class="token comment">// 优先级</span></span>
<span class="line">    <span class="token operator">&amp;</span>xHandle           <span class="token comment">// 任务句柄</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 任务函数实现</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">vTaskFunction</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>pvParameters<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 任务代码</span></span>
<span class="line">        <span class="token function">vTaskDelay</span><span class="token punctuation">(</span><span class="token function">pdMS_TO_TICKS</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 延时1秒</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>任务调度</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 任务延时</span></span>
<span class="line"><span class="token function">vTaskDelay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 延时1000个ticks</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 相对延时转换</span></span>
<span class="line"><span class="token function">vTaskDelay</span><span class="token punctuation">(</span><span class="token function">pdMS_TO_TICKS</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 延时1000毫秒</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 任务挂起和恢复</span></span>
<span class="line"><span class="token function">vTaskSuspend</span><span class="token punctuation">(</span>xHandle<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">vTaskResume</span><span class="token punctuation">(</span>xHandle<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 任务删除</span></span>
<span class="line"><span class="token function">vTaskDelete</span><span class="token punctuation">(</span>xHandle<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>任务优先级和调度</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 设置任务优先级</span></span>
<span class="line"><span class="token function">vTaskPrioritySet</span><span class="token punctuation">(</span>xHandle<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 获取当前任务优先级</span></span>
<span class="line">UBaseType_t uxPriority <span class="token operator">=</span> <span class="token function">uxTaskPriorityGet</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 临时提升优先级（优先级继承）</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q9-freertos同步机制" tabindex="-1"><a class="header-anchor" href="#q9-freertos同步机制"><span>Q9: FreeRTOS同步机制？</span></a></h3><p><strong>答：</strong> FreeRTOS提供多种任务同步机制：</p><p><strong>二值信号量</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 创建二值信号量</span></span>
<span class="line">SemaphoreHandle_t xBinarySemaphore<span class="token punctuation">;</span></span>
<span class="line">xBinarySemaphore <span class="token operator">=</span> <span class="token function">xSemaphoreCreateBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 中断中给出信号量</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">vAnInterruptHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    BaseType_t xHigherPriorityTaskWoken <span class="token operator">=</span> pdFALSE<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">xSemaphoreGiveFromISR</span><span class="token punctuation">(</span>xBinarySemaphore<span class="token punctuation">,</span> <span class="token operator">&amp;</span>xHigherPriorityTaskWoken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">portYIELD_FROM_ISR</span><span class="token punctuation">(</span>xHigherPriorityTaskWoken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 任务中获取信号量</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">vTaskFunction</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>pvParameters<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">xSemaphoreTake</span><span class="token punctuation">(</span>xBinarySemaphore<span class="token punctuation">,</span> portMAX_DELAY<span class="token punctuation">)</span> <span class="token operator">==</span> pdTRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 处理中断事件</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>互斥量</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 创建互斥量</span></span>
<span class="line">SemaphoreHandle_t xMutex<span class="token punctuation">;</span></span>
<span class="line">xMutex <span class="token operator">=</span> <span class="token function">xSemaphoreCreateMutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 获取互斥量</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">xSemaphoreTake</span><span class="token punctuation">(</span>xMutex<span class="token punctuation">,</span> portMAX_DELAY<span class="token punctuation">)</span> <span class="token operator">==</span> pdTRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 访问共享资源</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">    <span class="token comment">// 释放互斥量</span></span>
<span class="line">    <span class="token function">xSemaphoreGive</span><span class="token punctuation">(</span>xMutex<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>消息队列</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 创建消息队列</span></span>
<span class="line">QueueHandle_t xQueue<span class="token punctuation">;</span></span>
<span class="line">xQueue <span class="token operator">=</span> <span class="token function">xQueueCreate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 发送消息</span></span>
<span class="line"><span class="token class-name">uint32_t</span> ulValue <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">xQueueSend</span><span class="token punctuation">(</span>xQueue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ulValue<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 接收消息</span></span>
<span class="line"><span class="token class-name">uint32_t</span> ulReceivedValue<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">xQueueReceive</span><span class="token punctuation">(</span>xQueue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ulReceivedValue<span class="token punctuation">,</span> portMAX_DELAY<span class="token punctuation">)</span> <span class="token operator">==</span> pdPASS<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 处理接收到的数据</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-嵌入式外设驱动" tabindex="-1"><a class="header-anchor" href="#_4-嵌入式外设驱动"><span>4. 嵌入式外设驱动</span></a></h2><h3 id="q10-gpio驱动开发" tabindex="-1"><a class="header-anchor" href="#q10-gpio驱动开发"><span>Q10: GPIO驱动开发？</span></a></h3><p><strong>答：</strong> GPIO（General Purpose Input/Output）是最基本的外设接口。</p><p><strong>GPIO配置</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// STM32 GPIO配置示例</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">GPIO_Configuration</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    GPIO_InitTypeDef GPIO_InitStruct <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 使能GPIO时钟</span></span>
<span class="line">    <span class="token function">__HAL_RCC_GPIOA_CLK_ENABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 配置输出GPIO</span></span>
<span class="line">    GPIO_InitStruct<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_5<span class="token punctuation">;</span></span>
<span class="line">    GPIO_InitStruct<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span>  <span class="token comment">// 推挽输出</span></span>
<span class="line">    GPIO_InitStruct<span class="token punctuation">.</span>Pull <span class="token operator">=</span> GPIO_NOPULL<span class="token punctuation">;</span></span>
<span class="line">    GPIO_InitStruct<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_LOW<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 配置输入GPIO</span></span>
<span class="line">    GPIO_InitStruct<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_0<span class="token punctuation">;</span></span>
<span class="line">    GPIO_InitStruct<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_INPUT<span class="token punctuation">;</span>      <span class="token comment">// 输入模式</span></span>
<span class="line">    GPIO_InitStruct<span class="token punctuation">.</span>Pull <span class="token operator">=</span> GPIO_PULLUP<span class="token punctuation">;</span>         <span class="token comment">// 上拉</span></span>
<span class="line">    <span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// GPIO操作</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">Toggle_LED</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_PIN_5<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">uint8_t</span> <span class="token function">Read_Button</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_PIN_0<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q11-uart串口通信" tabindex="-1"><a class="header-anchor" href="#q11-uart串口通信"><span>Q11: UART串口通信？</span></a></h3><p><strong>答：</strong> UART（Universal Asynchronous Receiver/Transmitter）是常用的异步串行通信接口。</p><p><strong>UART初始化</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// STM32 UART配置</span></span>
<span class="line">UART_HandleTypeDef huart1<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">UART_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    huart1<span class="token punctuation">.</span>Instance <span class="token operator">=</span> USART1<span class="token punctuation">;</span></span>
<span class="line">    huart1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> <span class="token number">115200</span><span class="token punctuation">;</span></span>
<span class="line">    huart1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>WordLength <span class="token operator">=</span> UART_WORDLENGTH_8B<span class="token punctuation">;</span></span>
<span class="line">    huart1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> UART_STOPBITS_1<span class="token punctuation">;</span></span>
<span class="line">    huart1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Parity <span class="token operator">=</span> UART_PARITY_NONE<span class="token punctuation">;</span></span>
<span class="line">    huart1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Mode <span class="token operator">=</span> UART_MODE_TX_RX<span class="token punctuation">;</span></span>
<span class="line">    huart1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>HwFlowCtl <span class="token operator">=</span> UART_HWCONTROL_NONE<span class="token punctuation">;</span></span>
<span class="line">    huart1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>OverSampling <span class="token operator">=</span> UART_OVERSAMPLING_16<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_UART_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 发送数据</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">UART_SendString</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">HAL_UART_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span>str<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> HAL_MAX_DELAY<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 接收数据（中断方式）</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">UART_ReceiveIT</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">HAL_UART_Receive_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rxData<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 接收回调函数</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">HAL_UART_RxCpltCallback</span><span class="token punctuation">(</span>UART_HandleTypeDef <span class="token operator">*</span>huart<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>huart<span class="token operator">-&gt;</span>Instance <span class="token operator">==</span> USART1<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 处理接收到的数据</span></span>
<span class="line">        <span class="token function">HAL_UART_Receive_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rxData<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重新启动接收</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q12-spi和i2c通信" tabindex="-1"><a class="header-anchor" href="#q12-spi和i2c通信"><span>Q12: SPI和I2C通信？</span></a></h3><p><strong>答：</strong> SPI和I2C是常用的同步串行通信协议。</p><p><strong>SPI通信</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// SPI配置</span></span>
<span class="line">SPI_HandleTypeDef hspi1<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">SPI_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Instance <span class="token operator">=</span> SPI1<span class="token punctuation">;</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Mode <span class="token operator">=</span> SPI_MODE_MASTER<span class="token punctuation">;</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Direction <span class="token operator">=</span> SPI_DIRECTION_2LINES<span class="token punctuation">;</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>DataSize <span class="token operator">=</span> SPI_DATASIZE_8BIT<span class="token punctuation">;</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>CLKPolarity <span class="token operator">=</span> SPI_POLARITY_LOW<span class="token punctuation">;</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>CLKPhase <span class="token operator">=</span> SPI_PHASE_1EDGE<span class="token punctuation">;</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>NSS <span class="token operator">=</span> SPI_NSS_SOFT<span class="token punctuation">;</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>BaudRatePrescaler <span class="token operator">=</span> SPI_BAUDRATEPRESCALER_16<span class="token punctuation">;</span></span>
<span class="line">    hspi1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>FirstBit <span class="token operator">=</span> SPI_FIRSTBIT_MSB<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_SPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hspi1<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// SPI数据传输</span></span>
<span class="line">HAL_StatusTypeDef <span class="token function">SPI_TransmitReceive</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>txData<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> <span class="token operator">*</span>rxData<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">HAL_SPI_TransmitReceive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hspi1<span class="token punctuation">,</span> txData<span class="token punctuation">,</span> rxData<span class="token punctuation">,</span> size<span class="token punctuation">,</span> HAL_MAX_DELAY<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>I2C通信</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// I2C配置</span></span>
<span class="line">I2C_HandleTypeDef hi2c1<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">I2C_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    hi2c1<span class="token punctuation">.</span>Instance <span class="token operator">=</span> I2C1<span class="token punctuation">;</span></span>
<span class="line">    hi2c1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>ClockSpeed <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span></span>
<span class="line">    hi2c1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>DutyCycle <span class="token operator">=</span> I2C_DUTYCYCLE_2<span class="token punctuation">;</span></span>
<span class="line">    hi2c1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>OwnAddress1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    hi2c1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>AddressingMode <span class="token operator">=</span> I2C_ADDRESSINGMODE_7BIT<span class="token punctuation">;</span></span>
<span class="line">    hi2c1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>DualAddressMode <span class="token operator">=</span> I2C_DUALADDRESS_DISABLE<span class="token punctuation">;</span></span>
<span class="line">    hi2c1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>GeneralCallMode <span class="token operator">=</span> I2C_GENERALCALL_DISABLE<span class="token punctuation">;</span></span>
<span class="line">    hi2c1<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>NoStretchMode <span class="token operator">=</span> I2C_NOSTRETCH_DISABLE<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_I2C_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hi2c1<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// I2C写操作</span></span>
<span class="line">HAL_StatusTypeDef <span class="token function">I2C_Write</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> DevAddress<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> <span class="token operator">*</span>pData<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Size<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">HAL_I2C_Master_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hi2c1<span class="token punctuation">,</span> DevAddress<span class="token punctuation">,</span> pData<span class="token punctuation">,</span> Size<span class="token punctuation">,</span> HAL_MAX_DELAY<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// I2C读操作</span></span>
<span class="line">HAL_StatusTypeDef <span class="token function">I2C_Read</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> DevAddress<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> <span class="token operator">*</span>pData<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Size<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">HAL_I2C_Master_Receive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hi2c1<span class="token punctuation">,</span> DevAddress<span class="token punctuation">,</span> pData<span class="token punctuation">,</span> Size<span class="token punctuation">,</span> HAL_MAX_DELAY<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-嵌入式系统设计" tabindex="-1"><a class="header-anchor" href="#_5-嵌入式系统设计"><span>5. 嵌入式系统设计</span></a></h2><h3 id="q13-嵌入式系统低功耗设计" tabindex="-1"><a class="header-anchor" href="#q13-嵌入式系统低功耗设计"><span>Q13: 嵌入式系统低功耗设计？</span></a></h3><p><strong>答：</strong> 低功耗设计是嵌入式系统的重要考虑因素，特别是电池供电设备。</p><p><strong>硬件层面</strong>：</p><ol><li><p><strong>选择低功耗器件</strong>：</p><ul><li>低功耗MCU</li><li>低功耗传感器</li><li>电源管理芯片</li></ul></li><li><p><strong>电源管理</strong>：</p><ul><li>多电压域设计</li><li>动态电压频率调节（DVFS）</li><li>电源开关控制</li></ul></li></ol><p><strong>软件层面</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 进入睡眠模式</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">EnterSleepMode</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 关闭不必要的外设时钟</span></span>
<span class="line">    <span class="token function">__HAL_RCC_USART1_CLK_DISABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">__HAL_RCC_SPI1_CLK_DISABLE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 配置唤醒源</span></span>
<span class="line">    <span class="token function">HAL_PWR_EnableWakeUpPin</span><span class="token punctuation">(</span>PWR_WAKEUP_PIN1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 进入睡眠模式</span></span>
<span class="line">    <span class="token function">HAL_PWR_EnterSLEEPMode</span><span class="token punctuation">(</span>PWR_MAINREGULATOR_ON<span class="token punctuation">,</span> PWR_SLEEPENTRY_WFI<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 周期性任务调度</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">LowPowerTaskScheduler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 执行必要的任务</span></span>
<span class="line">        <span class="token function">ProcessSensorData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">UpdateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 进入低功耗模式等待下次唤醒</span></span>
<span class="line">        <span class="token function">EnterSleepMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 唤醒后继续执行</span></span>
<span class="line">        <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 系统稳定</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>功耗优化策略</strong>：</p><ol><li><p><strong>动态功耗管理</strong>：</p><ul><li>根据负载动态调整CPU频率</li><li>按需开启/关闭外设</li></ul></li><li><p><strong>睡眠模式利用</strong>：</p><ul><li>空闲时进入睡眠模式</li><li>使用外部中断唤醒</li></ul></li><li><p><strong>时钟管理</strong>：</p><ul><li>关闭不使用的时钟</li><li>使用低频时钟</li></ul></li></ol><h3 id="q14-嵌入式系统可靠性设计" tabindex="-1"><a class="header-anchor" href="#q14-嵌入式系统可靠性设计"><span>Q14: 嵌入式系统可靠性设计？</span></a></h3><p><strong>答：</strong> 嵌入式系统的可靠性设计包括以下几个方面：</p><p><strong>硬件可靠性</strong>：</p><ol><li><p><strong>电源设计</strong>：</p><ul><li>电源滤波和稳压</li><li>电源监控和复位电路</li><li>备用电源支持</li></ul></li><li><p><strong>EMC设计</strong>：</p><ul><li>PCB布局优化</li><li>屏蔽和滤波</li><li>接地设计</li></ul></li></ol><p><strong>软件可靠性</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 看门狗定时器</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;watchdog.h&quot;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">Watchdog_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 配置独立看门狗</span></span>
<span class="line">    IWDG_HandleTypeDef hiwdg<span class="token punctuation">;</span></span>
<span class="line">    hiwdg<span class="token punctuation">.</span>Instance <span class="token operator">=</span> IWDG<span class="token punctuation">;</span></span>
<span class="line">    hiwdg<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Prescaler <span class="token operator">=</span> IWDG_PRESCALER_32<span class="token punctuation">;</span></span>
<span class="line">    hiwdg<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Reload <span class="token operator">=</span> <span class="token number">4095</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_IWDG_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hiwdg<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定期喂狗</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">FeedWatchdog</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">HAL_IWDG_Refresh</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hiwdg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 主循环中喂狗</span></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">SystemInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">Watchdog_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 执行任务</span></span>
<span class="line">        <span class="token function">Task1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">Task2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 喂狗</span></span>
<span class="line">        <span class="token function">FeedWatchdog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 延时</span></span>
<span class="line">        <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>错误处理和恢复</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 错误处理机制</span></span>
<span class="line"><span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token punctuation">{</span></span>
<span class="line">    ERROR_NONE <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    ERROR_UART<span class="token punctuation">,</span></span>
<span class="line">    ERROR_SPI<span class="token punctuation">,</span></span>
<span class="line">    ERROR_I2C<span class="token punctuation">,</span></span>
<span class="line">    ERROR_MEMORY</span>
<span class="line"><span class="token punctuation">}</span> ErrorCode_t<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 错误计数和恢复</span></span>
<span class="line"><span class="token keyword">static</span> <span class="token class-name">uint32_t</span> errorCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">ErrorHandler</span><span class="token punctuation">(</span>ErrorCode_t errorCode<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    errorCount<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 记录错误日志</span></span>
<span class="line">    <span class="token function">LogError</span><span class="token punctuation">(</span>errorCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 如果错误过多，系统复位</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>errorCount <span class="token operator">&gt;</span> MAX_ERROR_COUNT<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">NVIC_SystemReset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 尝试恢复</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>errorCode<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> ERROR_UART<span class="token operator">:</span></span>
<span class="line">            <span class="token function">UART_Recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">case</span> ERROR_SPI<span class="token operator">:</span></span>
<span class="line">            <span class="token function">SPI_Recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 其他错误处理</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>软件看门狗</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 任务监控</span></span>
<span class="line"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">uint32_t</span> lastAliveTime<span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">uint32_t</span> timeout<span class="token punctuation">;</span></span>
<span class="line">    bool isRunning<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> TaskMonitor_t<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">TaskMonitor_t taskMonitors<span class="token punctuation">[</span>MAX_TASKS<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">TaskMonitor_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX_TASKS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        taskMonitors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lastAliveTime <span class="token operator">=</span> <span class="token function">HAL_GetTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        taskMonitors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span> <span class="token comment">// 5秒超时</span></span>
<span class="line">        taskMonitors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isRunning <span class="token operator">=</span> false<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">TaskAlive</span><span class="token punctuation">(</span><span class="token keyword">int</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskId <span class="token operator">&lt;</span> MAX_TASKS<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        taskMonitors<span class="token punctuation">[</span>taskId<span class="token punctuation">]</span><span class="token punctuation">.</span>lastAliveTime <span class="token operator">=</span> <span class="token function">HAL_GetTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        taskMonitors<span class="token punctuation">[</span>taskId<span class="token punctuation">]</span><span class="token punctuation">.</span>isRunning <span class="token operator">=</span> true<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">TaskMonitor_Check</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">uint32_t</span> currentTime <span class="token operator">=</span> <span class="token function">HAL_GetTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX_TASKS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskMonitors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>currentTime <span class="token operator">-</span> taskMonitors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lastAliveTime<span class="token punctuation">)</span> <span class="token operator">&gt;</span> taskMonitors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 任务超时，系统复位</span></span>
<span class="line">                <span class="token function">SystemReset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-嵌入式调试和测试" tabindex="-1"><a class="header-anchor" href="#_6-嵌入式调试和测试"><span>6. 嵌入式调试和测试</span></a></h2><h3 id="q15-嵌入式系统调试方法" tabindex="-1"><a class="header-anchor" href="#q15-嵌入式系统调试方法"><span>Q15: 嵌入式系统调试方法？</span></a></h3><p><strong>答：</strong> 嵌入式系统调试包括硬件调试和软件调试：</p><p><strong>硬件调试工具</strong>：</p><ol><li><strong>示波器</strong>：观察信号波形</li><li><strong>逻辑分析仪</strong>：分析数字信号时序</li><li><strong>万用表</strong>：测量电压、电流、电阻</li><li><strong>频谱分析仪</strong>：分析信号频谱</li></ol><p><strong>软件调试方法</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 调试输出</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">DBG_PRINT</span><span class="token expression"><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> </span><span class="token punctuation">##</span><span class="token expression">__VA_ARGS__<span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">DBG_PRINT</span><span class="token expression"><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 断言检查</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">ASSERT</span><span class="token expression"><span class="token punctuation">(</span>condition<span class="token punctuation">)</span> </span><span class="token punctuation">\</span></span>
<span class="line">    <span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">{</span> </span><span class="token punctuation">\</span></span>
<span class="line">        <span class="token expression"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span><span class="token punctuation">\</span></span>
<span class="line">            <span class="token expression"><span class="token function">printf</span><span class="token punctuation">(</span></span><span class="token string">&quot;ASSERTION FAILED: %s at %s:%d\n&quot;</span><span class="token expression"><span class="token punctuation">,</span> #condition<span class="token punctuation">,</span> <span class="token constant">__FILE__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span></span>
<span class="line">            <span class="token expression"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span></span>
<span class="line">        <span class="token expression"><span class="token punctuation">}</span> </span><span class="token punctuation">\</span></span>
<span class="line">    <span class="token expression"><span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">ASSERT</span><span class="token expression"><span class="token punctuation">(</span>condition<span class="token punctuation">)</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用示例</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">TestFunction</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">GetSomeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">ASSERT</span><span class="token punctuation">(</span>value <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 确保值非负</span></span>
<span class="line">    <span class="token function">DBG_PRINT</span><span class="token punctuation">(</span><span class="token string">&quot;Value: %d\n&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>实时调试</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 实时变量监控</span></span>
<span class="line"><span class="token keyword">volatile</span> <span class="token class-name">uint32_t</span> debugVar1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">volatile</span> <span class="token class-name">uint32_t</span> debugVar2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">MainLoop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 主要任务</span></span>
<span class="line">        <span class="token function">Task1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">Task2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 更新调试变量</span></span>
<span class="line">        debugVar1 <span class="token operator">=</span> <span class="token function">GetSystemStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        debugVar2 <span class="token operator">=</span> <span class="token function">GetSensorValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q16-嵌入式系统测试策略" tabindex="-1"><a class="header-anchor" href="#q16-嵌入式系统测试策略"><span>Q16: 嵌入式系统测试策略？</span></a></h3><p><strong>答：</strong> 嵌入式系统的测试策略包括多个层次：</p><p><strong>单元测试</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 测试框架示例</span></span>
<span class="line"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>test_func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    bool passed<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> TestCase_t<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">Test_GPIO_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 测试GPIO初始化</span></span>
<span class="line">    <span class="token function">GPIO_Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 验证配置结果</span></span>
<span class="line">    <span class="token function">assert</span><span class="token punctuation">(</span>GPIOA<span class="token operator">-&gt;</span>MODER <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// PA5应为输出</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">Test_UART_Transmit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">char</span> testData<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 发送测试数据</span></span>
<span class="line">    <span class="token function">UART_SendString</span><span class="token punctuation">(</span>testData<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 验证发送结果（通过回环测试或其他方法）</span></span>
<span class="line">    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">UART_GetStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> UART_STATUS_OK<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">TestCase_t testCases<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;GPIO Init Test&quot;</span><span class="token punctuation">,</span> Test_GPIO_Init<span class="token punctuation">,</span> false<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;UART Transmit Test&quot;</span><span class="token punctuation">,</span> Test_UART_Transmit<span class="token punctuation">,</span> false<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">// 更多测试用例</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">RunAllTests</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>testCases<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>TestCase_t<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Running %s...\n&quot;</span><span class="token punctuation">,</span> testCases<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        testCases<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">test_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s: %s\n&quot;</span><span class="token punctuation">,</span> testCases<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> </span>
<span class="line">               testCases<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>passed <span class="token operator">?</span> <span class="token string">&quot;PASSED&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;FAILED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>集成测试</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 系统级测试</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">IntegrationTest_SensorDataFlow</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 模拟传感器数据输入</span></span>
<span class="line">    <span class="token function">SimulateSensorInput</span><span class="token punctuation">(</span>TEST_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 等待数据处理完成</span></span>
<span class="line">    <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 验证处理结果</span></span>
<span class="line">    <span class="token class-name">uint32_t</span> result <span class="token operator">=</span> <span class="token function">GetProcessedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">assert</span><span class="token punctuation">(</span>result <span class="token operator">==</span> EXPECTED_RESULT<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 验证数据输出</span></span>
<span class="line">    <span class="token keyword">char</span> <span class="token operator">*</span>output <span class="token operator">=</span> <span class="token function">GetLastOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> EXPECTED_OUTPUT<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>环境测试</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 温度测试</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">EnvironmentalTest_HighTemperature</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 模拟高温环境</span></span>
<span class="line">    <span class="token function">SetTemperature</span><span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 85°C</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 运行系统一段时间</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">MainLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 验证系统稳定性</span></span>
<span class="line">    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">GetErrorCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">GetSystemStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> STATUS_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 电源波动测试</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">EnvironmentalTest_PowerVariation</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 模拟电源电压波动</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> voltage <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span> voltage <span class="token operator">&lt;=</span> <span class="token number">3600</span><span class="token punctuation">;</span> voltage <span class="token operator">+=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">SetSupplyVoltage</span><span class="token punctuation">(</span>voltage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 验证系统正常工作</span></span>
<span class="line">        <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">GetSystemStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> STATUS_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>自动化测试</strong>：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 测试自动化框架</span></span>
<span class="line"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>setup<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>teardown<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    TestCase_t <span class="token operator">*</span>test_cases<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> test_count<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> TestSuite_t<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">RunTestSuite</span><span class="token punctuation">(</span>TestSuite_t <span class="token operator">*</span>suite<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 执行测试前准备</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>suite<span class="token operator">-&gt;</span>setup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        suite<span class="token operator">-&gt;</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 运行所有测试</span></span>
<span class="line">    <span class="token keyword">int</span> passed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> suite<span class="token operator">-&gt;</span>test_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Test %d: %s\n&quot;</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> suite<span class="token operator">-&gt;</span>test_cases<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        suite<span class="token operator">-&gt;</span>test_cases<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">test_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>suite<span class="token operator">-&gt;</span>test_cases<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>passed<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            passed<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 输出测试结果</span></span>
<span class="line">    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Test Suite Result: %d/%d passed\n&quot;</span><span class="token punctuation">,</span> passed<span class="token punctuation">,</span> suite<span class="token operator">-&gt;</span>test_count<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 清理</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>suite<span class="token operator">-&gt;</span>teardown<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        suite<span class="token operator">-&gt;</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script src="/wiki/assets/js/runtime~app.e5a338d5.js" defer></script><script src="/wiki/assets/js/768.e6d4205d.js" defer></script><script src="/wiki/assets/js/app.afddf092.js" defer></script>
  </body>
</html>
